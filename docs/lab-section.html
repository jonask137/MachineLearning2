<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.2 Lab section | Machine Learning for Business Intelligence 2</title>
  <meta name="description" content="2.2 Lab section | Machine Learning for Business Intelligence 2" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="2.2 Lab section | Machine Learning for Business Intelligence 2" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.2 Lab section | Machine Learning for Business Intelligence 2" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="models-beyond-linearity.html"/>
<link rel="next" href="exercises.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>setup</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html"><i class="fa fa-check"></i><b>2</b> Moving Beyond Linearity</a>
<ul>
<li class="chapter" data-level="2.1" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html"><i class="fa fa-check"></i><b>2.1</b> Models Beyond Linearity</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#polynomial-regression"><i class="fa fa-check"></i><b>2.1.1</b> Polynomial Regression</a>
<ul>
<li class="chapter" data-level="2.1.1.1" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#beta-coefficients-and-variance"><i class="fa fa-check"></i><b>2.1.1.1</b> Beta coefficients and variance</a></li>
<li class="chapter" data-level="2.1.1.2" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#application-procedure"><i class="fa fa-check"></i><b>2.1.1.2</b> Application procedure</a></li>
</ul></li>
<li class="chapter" data-level="2.1.2" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#step-functions"><i class="fa fa-check"></i><b>2.1.2</b> Step Functions</a></li>
<li class="chapter" data-level="2.1.3" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#regression-splines"><i class="fa fa-check"></i><b>2.1.3</b> Regression Splines</a>
<ul>
<li class="chapter" data-level="2.1.3.1" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#piecewise-polynomials"><i class="fa fa-check"></i><b>2.1.3.1</b> Piecewise Polynomials</a></li>
<li class="chapter" data-level="2.1.3.2" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#constraints-and-splines"><i class="fa fa-check"></i><b>2.1.3.2</b> Constraints and Splines</a></li>
<li class="chapter" data-level="2.1.3.3" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#choosing-the-number-and-location-of-the-knots"><i class="fa fa-check"></i><b>2.1.3.3</b> Choosing the number and location of the Knots</a></li>
<li class="chapter" data-level="2.1.3.4" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#comparison-with-polynomial-regression"><i class="fa fa-check"></i><b>2.1.3.4</b> Comparison with Polynomial Regression</a></li>
</ul></li>
<li class="chapter" data-level="2.1.4" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#smoothing-splines"><i class="fa fa-check"></i><b>2.1.4</b> Smoothing Splines</a>
<ul>
<li class="chapter" data-level="2.1.4.1" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#choosing-optimal-tuning-parameter"><i class="fa fa-check"></i><b>2.1.4.1</b> Choosing optimal tuning parameter</a></li>
</ul></li>
<li class="chapter" data-level="2.1.5" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#local-regression"><i class="fa fa-check"></i><b>2.1.5</b> Local Regression</a></li>
<li class="chapter" data-level="2.1.6" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#generalized-additive-models"><i class="fa fa-check"></i><b>2.1.6</b> Generalized Additive Models</a>
<ul>
<li class="chapter" data-level="2.1.6.1" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#gam-for-regression-problems"><i class="fa fa-check"></i><b>2.1.6.1</b> GAM for regression problems</a></li>
<li class="chapter" data-level="2.1.6.2" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#gam-for-classification-problems"><i class="fa fa-check"></i><b>2.1.6.2</b> GAM for classification problems</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="lab-section.html"><a href="lab-section.html"><i class="fa fa-check"></i><b>2.2</b> Lab section</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="lab-section.html"><a href="lab-section.html#polynomial-regression-and-step-functions"><i class="fa fa-check"></i><b>2.2.1</b> Polynomial Regression and Step Functions</a>
<ul>
<li class="chapter" data-level="2.2.1.1" data-path="lab-section.html"><a href="lab-section.html#continous-model"><i class="fa fa-check"></i><b>2.2.1.1</b> Continous model</a></li>
<li class="chapter" data-level="2.2.1.2" data-path="lab-section.html"><a href="lab-section.html#logarithmic-model"><i class="fa fa-check"></i><b>2.2.1.2</b> Logarithmic model</a></li>
<li class="chapter" data-level="2.2.1.3" data-path="lab-section.html"><a href="lab-section.html#step-function"><i class="fa fa-check"></i><b>2.2.1.3</b> Step function</a></li>
</ul></li>
<li class="chapter" data-level="2.2.2" data-path="lab-section.html"><a href="lab-section.html#splines"><i class="fa fa-check"></i><b>2.2.2</b> Splines</a>
<ul>
<li class="chapter" data-level="2.2.2.1" data-path="lab-section.html"><a href="lab-section.html#basis-function-splines"><i class="fa fa-check"></i><b>2.2.2.1</b> Basis Function Splines</a></li>
<li class="chapter" data-level="2.2.2.2" data-path="lab-section.html"><a href="lab-section.html#natural-splines"><i class="fa fa-check"></i><b>2.2.2.2</b> Natural Splines</a></li>
<li class="chapter" data-level="2.2.2.3" data-path="lab-section.html"><a href="lab-section.html#smooth-splines"><i class="fa fa-check"></i><b>2.2.2.3</b> Smooth Splines</a></li>
<li class="chapter" data-level="2.2.2.4" data-path="lab-section.html"><a href="lab-section.html#local-regression-1"><i class="fa fa-check"></i><b>2.2.2.4</b> Local Regression</a></li>
</ul></li>
<li class="chapter" data-level="2.2.3" data-path="lab-section.html"><a href="lab-section.html#gams"><i class="fa fa-check"></i><b>2.2.3</b> GAMs</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>2.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="exercises.html"><a href="exercises.html#exercise-6-lecture-1"><i class="fa fa-check"></i><b>2.3.1</b> Exercise 6 (Lecture 1)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tree-based-methods.html"><a href="tree-based-methods.html"><i class="fa fa-check"></i><b>3</b> Tree Based Methods</a></li>
<li class="chapter" data-level="4" data-path="subject-1.html"><a href="subject-1.html"><i class="fa fa-check"></i><b>4</b> Subject 1</a></li>
<li class="chapter" data-level="5" data-path="subject-1-1.html"><a href="subject-1-1.html"><i class="fa fa-check"></i><b>5</b> Subject 1</a></li>
<li class="chapter" data-level="6" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>6</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Machine Learning for Business Intelligence 2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lab-section" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Lab section</h2>
<p>Loading the data that will be used throughout the lab section.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="lab-section.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR)</span>
<span id="cb3-2"><a href="lab-section.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(Wage)</span>
<span id="cb3-3"><a href="lab-section.html#cb3-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> Wage</span></code></pre></div>
<p><br />
</p>
<div id="polynomial-regression-and-step-functions" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Polynomial Regression and Step Functions</h3>
<div id="continous-model" class="section level4" number="2.2.1.1">
<h4><span class="header-section-number">2.2.1.1</span> Continous model</h4>
<p>Fitting the model:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="lab-section.html#cb4-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age,<span class="dv">4</span>) <span class="co">#Orthogonal polynomials</span></span>
<span id="cb4-2"><a href="lab-section.html#cb4-2" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">data =</span> df)</span>
<span id="cb4-3"><a href="lab-section.html#cb4-3" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age,<span class="dv">4</span>,<span class="at">raw =</span> <span class="cn">TRUE</span>) <span class="co">#Orthogonal polynomials</span></span>
<span id="cb4-4"><a href="lab-section.html#cb4-4" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">data =</span> df)</span></code></pre></div>
<p>Note: <code>poly()</code> returns orthogonal polynomials, which is some linear combination of the variables to the d power. See the following two examples when using orthogonal and normal polynomials:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="lab-section.html#cb5-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-2"><a href="lab-section.html#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Orthogonal&quot;</span>)</span>
<span id="cb5-3"><a href="lab-section.html#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(df<span class="sc">$</span>age,<span class="fu">poly</span>(<span class="at">x =</span> df<span class="sc">$</span>age,<span class="at">degree =</span> <span class="dv">4</span>))[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]  <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb5-4"><a href="lab-section.html#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Regular&quot;</span>)</span>
<span id="cb5-5"><a href="lab-section.html#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(df<span class="sc">$</span>age,<span class="fu">poly</span>(<span class="at">x =</span> df<span class="sc">$</span>age,<span class="at">degree =</span> <span class="dv">4</span>,<span class="at">raw =</span> <span class="cn">TRUE</span>))[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,] <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb5-6"><a href="lab-section.html#cb5-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;Orthogonal&quot;
##                     1            2             3           4
## [1,] 18 -0.0386247992  0.055908727 -0.0717405794  0.08672985
## [2,] 24 -0.0291326034  0.026298066 -0.0145499511 -0.00259928
## [3,] 45  0.0040900817 -0.014506548 -0.0001331835  0.01448009
## [4,] 43  0.0009260164 -0.014831404  0.0045136682  0.01265751
## [5,] 50  0.0120002448 -0.009815846 -0.0111366263  0.01021146
## [1] &quot;Regular&quot;
##          1    2      3       4
## [1,] 18 18  324   5832  104976
## [2,] 24 24  576  13824  331776
## [3,] 45 45 2025  91125 4100625
## [4,] 43 43 1849  79507 3418801
## [5,] 50 50 2500 125000 6250000</code></pre>
<p>In the end, it does not have a noticeable effect.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="lab-section.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">5</span>)</span>
<span id="cb7-2"><a href="lab-section.html#cb7-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb7-3"><a href="lab-section.html#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(<span class="fu">summary</span>(fit)) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb7-4"><a href="lab-section.html#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(<span class="fu">summary</span>(fit2)) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb7-5"><a href="lab-section.html#cb7-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>##                 Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept)    111.70361  0.7287409 153.283015 0.000000e+00
## poly(age, 4)1  447.06785 39.9147851  11.200558 1.484604e-28
## poly(age, 4)2 -478.31581 39.9147851 -11.983424 2.355831e-32
## poly(age, 4)3  125.52169 39.9147851   3.144742 1.678622e-03
## poly(age, 4)4  -77.91118 39.9147851  -1.951938 5.103865e-02
##                                  Estimate     Std. Error   t value     Pr(&gt;|t|)
## (Intercept)               -184.1541797743 60.04037718327 -3.067172 0.0021802539
## poly(age, 4, raw = TRUE)1   21.2455205321  5.88674824448  3.609042 0.0003123618
## poly(age, 4, raw = TRUE)2   -0.5638593126  0.20610825640 -2.735743 0.0062606446
## poly(age, 4, raw = TRUE)3    0.0068106877  0.00306593115  2.221409 0.0263977518
## poly(age, 4, raw = TRUE)4   -0.0000320383  0.00001641359 -1.951938 0.0510386498</code></pre>
<p>Even though the coefficients are different and the p-values hereof, the fitted values will be indistinguishable <span class="citation">(<a href="references.html#ref-hastie2013" role="doc-biblioref">Hastie et al. 2013, 288</a>)</span>. This is also shown later.</p>
<p><em>Alternatives to using <code>poly()</code>??</em></p>
<p>We have two alternatives:</p>
<ol style="list-style-type: decimal">
<li><p>Using <code>I()</code></p></li>
<li><p>Using <code>cbind()</code></p></li>
<li><p>Using <code>I()</code></p></li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="lab-section.html#cb9-1" aria-hidden="true" tabindex="-1"></a>fit2a <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">4</span>) <span class="co">#Note that &#39;I()&#39; is added</span></span>
<span id="cb9-2"><a href="lab-section.html#cb9-2" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">data =</span> df)</span>
<span id="cb9-3"><a href="lab-section.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit2a)</span></code></pre></div>
<pre><code>##     (Intercept)             age        I(age^2)        I(age^3)        I(age^4) 
## -184.1541797743   21.2455205321   -0.5638593126    0.0068106877   -0.0000320383</code></pre>
<p><em>Notice <code>I()</code> as ‘^’ has another special meaning in formulas</em></p>
<p>Hence we see that the coefficients are the same.</p>
<ol start="2" style="list-style-type: decimal">
<li>Using <code>cbind()</code></li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="lab-section.html#cb11-1" aria-hidden="true" tabindex="-1"></a>fit2b <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">cbind</span>(age,age<span class="sc">^</span><span class="dv">2</span>,age<span class="sc">^</span><span class="dv">3</span>,age<span class="sc">^</span><span class="dv">4</span>)</span>
<span id="cb11-2"><a href="lab-section.html#cb11-2" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">data =</span> df)</span>
<span id="cb11-3"><a href="lab-section.html#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit2b)</span></code></pre></div>
<pre><code>##                        (Intercept) cbind(age, age^2, age^3, age^4)age 
##                    -184.1541797743                      21.2455205321 
##    cbind(age, age^2, age^3, age^4)    cbind(age, age^2, age^3, age^4) 
##                      -0.5638593126                       0.0068106877 
##    cbind(age, age^2, age^3, age^4) 
##                      -0.0000320383</code></pre>
<p>We see that we are now able to use ‘^’ within the <code>cbind()</code>.</p>
<p><br />
</p>
<p>proceeding with the lab sections. We can now present a grid of values for age, at which we want predictions and then call the <code>predict()</code> and also plot the standard errors.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="lab-section.html#cb13-1" aria-hidden="true" tabindex="-1"></a>agelims <span class="ot">&lt;-</span> <span class="fu">range</span>(df<span class="sc">$</span>age) <span class="co">#The min and max</span></span>
<span id="cb13-2"><a href="lab-section.html#cb13-2" aria-hidden="true" tabindex="-1"></a>age.grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> agelims[<span class="dv">1</span>],<span class="at">to =</span> agelims[<span class="dv">2</span>]) <span class="co">#Creating a counter within the range</span></span>
<span id="cb13-3"><a href="lab-section.html#cb13-3" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> fit</span>
<span id="cb13-4"><a href="lab-section.html#cb13-4" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid) <span class="co">#Creating a list with the counter named age, so it fits the IV naming</span></span>
<span id="cb13-5"><a href="lab-section.html#cb13-5" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-6"><a href="lab-section.html#cb13-6" aria-hidden="true" tabindex="-1"></a>se.bands <span class="ot">&lt;-</span> <span class="fu">cbind</span>(preds<span class="sc">$</span>fit <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>preds<span class="sc">$</span>se.fit <span class="co">#Upper band</span></span>
<span id="cb13-7"><a href="lab-section.html#cb13-7" aria-hidden="true" tabindex="-1"></a>                  ,preds<span class="sc">$</span>fit<span class="dv">-2</span><span class="sc">*</span>preds<span class="sc">$</span>se.fit) <span class="co">#Lower band</span></span></code></pre></div>
<p>Now we can plot the data</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="lab-section.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb14-2"><a href="lab-section.html#cb14-2" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">3.1</span>,<span class="fl">4.5</span>,<span class="fl">4.5</span>,<span class="fl">1.1</span>) <span class="co">#Controls the margins</span></span>
<span id="cb14-3"><a href="lab-section.html#cb14-3" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>)) <span class="co">#Controls the margins</span></span>
<span id="cb14-4"><a href="lab-section.html#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="lab-section.html#cb14-5" aria-hidden="true" tabindex="-1"></a>{<span class="fu">plot</span>(<span class="at">x =</span> df<span class="sc">$</span>age,<span class="at">y =</span> df<span class="sc">$</span>wage</span>
<span id="cb14-6"><a href="lab-section.html#cb14-6" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlim =</span> agelims</span>
<span id="cb14-7"><a href="lab-section.html#cb14-7" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">cex =</span> <span class="fl">0.5</span> <span class="co">#Size of dots</span></span>
<span id="cb14-8"><a href="lab-section.html#cb14-8" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb14-9"><a href="lab-section.html#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Degree-4 Polynomial&quot;</span>,<span class="at">outer =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-10"><a href="lab-section.html#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid,<span class="at">y =</span> preds<span class="sc">$</span>fit</span>
<span id="cb14-11"><a href="lab-section.html#cb14-11" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb14-12"><a href="lab-section.html#cb14-12" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)}</span></code></pre></div>
<p><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-14-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>With the following we see that the difference of the fitted values are practically 0.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="lab-section.html#cb15-1" aria-hidden="true" tabindex="-1"></a>preds2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> fit2</span>
<span id="cb15-2"><a href="lab-section.html#cb15-2" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid)</span>
<span id="cb15-3"><a href="lab-section.html#cb15-3" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-4"><a href="lab-section.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">abs</span>(preds<span class="sc">$</span>fit<span class="sc">-</span>preds2<span class="sc">$</span>fit))</span></code></pre></div>
<pre><code>## [1] 7.81597e-11</code></pre>
<p>Now we can compare models with different orthogonal polynomials.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="lab-section.html#cb17-1" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage<span class="sc">~</span>age,<span class="at">data=</span>df)</span>
<span id="cb17-2"><a href="lab-section.html#cb17-2" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage<span class="sc">~</span><span class="fu">poly</span>(df<span class="sc">$</span>age,<span class="dv">2</span>),<span class="at">data=</span>df)</span>
<span id="cb17-3"><a href="lab-section.html#cb17-3" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage<span class="sc">~</span><span class="fu">poly</span>(df<span class="sc">$</span>age,<span class="dv">3</span>),<span class="at">data=</span>df)</span>
<span id="cb17-4"><a href="lab-section.html#cb17-4" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage<span class="sc">~</span><span class="fu">poly</span>(df<span class="sc">$</span>age,<span class="dv">4</span>),<span class="at">data=</span>df)</span>
<span id="cb17-5"><a href="lab-section.html#cb17-5" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage<span class="sc">~</span><span class="fu">poly</span>(df<span class="sc">$</span>age,<span class="dv">5</span>),<span class="at">data=</span>df)</span>
<span id="cb17-6"><a href="lab-section.html#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit<span class="fl">.1</span>,fit<span class="fl">.2</span>,fit<span class="fl">.3</span>,fit<span class="fl">.4</span>,fit<span class="fl">.5</span>)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">Res.Df</th>
<th align="right">RSS</th>
<th align="right">Df</th>
<th align="right">Sum of Sq</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2998</td>
<td align="right">5022216</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">2997</td>
<td align="right">4793430</td>
<td align="right">1</td>
<td align="right">228786.010</td>
<td align="right">143.5931074</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="right">2996</td>
<td align="right">4777674</td>
<td align="right">1</td>
<td align="right">15755.694</td>
<td align="right">9.8887559</td>
<td align="right">0.0016792</td>
</tr>
<tr class="even">
<td align="right">2995</td>
<td align="right">4771604</td>
<td align="right">1</td>
<td align="right">6070.152</td>
<td align="right">3.8098134</td>
<td align="right">0.0510462</td>
</tr>
<tr class="odd">
<td align="right">2994</td>
<td align="right">4770322</td>
<td align="right">1</td>
<td align="right">1282.563</td>
<td align="right">0.8049758</td>
<td align="right">0.3696820</td>
</tr>
</tbody>
</table>
</div>
<p>based on the anova we see that the errors change significantly util the 5th degree, hence the decision should be to take the model with order 4 of polynomials.</p>
<p>Notice, that the model will never become worse in sample when complexity is added, as we fit the model more to the data.</p>
<p><em>Alternative</em></p>
<p>We could also have obtained the same output using <code>coef()</code> instead of the anove, where we see that teh p-values are the same, also the squared value of t (<span class="math inline">\(t^2=F\)</span>).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="lab-section.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">summary</span>(fit<span class="fl">.5</span>))</span></code></pre></div>
<pre><code>##                    Estimate Std. Error     t value     Pr(&gt;|t|)
## (Intercept)       111.70361  0.7287647 153.2780243 0.000000e+00
## poly(df$age, 5)1  447.06785 39.9160847  11.2001930 1.491111e-28
## poly(df$age, 5)2 -478.31581 39.9160847 -11.9830341 2.367734e-32
## poly(df$age, 5)3  125.52169 39.9160847   3.1446392 1.679213e-03
## poly(df$age, 5)4  -77.91118 39.9160847  -1.9518743 5.104623e-02
## poly(df$age, 5)5  -35.81289 39.9160847  -0.8972045 3.696820e-01</code></pre>
<p><em>Notice: this is only an alternative when we exclusively have polynomials in the model!</em></p>
<p><br />
</p>
<p>The following is another example of using ANOVA where different variables are used:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="lab-section.html#cb20-1" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">lm</span>(wage<span class="sc">~</span>education <span class="sc">+</span>age ,<span class="at">data=</span>df)</span>
<span id="cb20-2"><a href="lab-section.html#cb20-2" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.2</span> <span class="ot">=</span> <span class="fu">lm</span>(wage<span class="sc">~</span>education <span class="sc">+</span><span class="fu">poly</span>(age ,<span class="dv">2</span>) ,<span class="at">data=</span>df)</span>
<span id="cb20-3"><a href="lab-section.html#cb20-3" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.3</span> <span class="ot">=</span> <span class="fu">lm</span>(wage<span class="sc">~</span>education <span class="sc">+</span><span class="fu">poly</span>(age ,<span class="dv">3</span>) ,<span class="at">data=</span>df)</span>
<span id="cb20-4"><a href="lab-section.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit<span class="fl">.1</span>,fit<span class="fl">.2</span>,fit<span class="fl">.3</span>)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">Res.Df</th>
<th align="right">RSS</th>
<th align="right">Df</th>
<th align="right">Sum of Sq</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2994</td>
<td align="right">3867992</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">2993</td>
<td align="right">3725395</td>
<td align="right">1</td>
<td align="right">142597.10</td>
<td align="right">114.696898</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="right">2992</td>
<td align="right">3719809</td>
<td align="right">1</td>
<td align="right">5586.66</td>
<td align="right">4.493588</td>
<td align="right">0.0341043</td>
</tr>
</tbody>
</table>
</div>
<p>We could also have chosen the order of polynomials using cross validation.</p>
</div>
<div id="logarithmic-model" class="section level4" number="2.2.1.2">
<h4><span class="header-section-number">2.2.1.2</span> Logarithmic model</h4>
<p>The procedure is per se the same, but now we are working with a probabilistic model instead of. Hence the outcome must be binary. Thus, it is decided to predict whether a persons wage is higher or lower than 250.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="lab-section.html#cb21-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">~</span> <span class="fu">poly</span>(age,<span class="dv">4</span>) <span class="co">#Note the use of I()</span></span>
<span id="cb21-2"><a href="lab-section.html#cb21-2" aria-hidden="true" tabindex="-1"></a>           ,<span class="at">data =</span> df</span>
<span id="cb21-3"><a href="lab-section.html#cb21-3" aria-hidden="true" tabindex="-1"></a>           ,<span class="at">family =</span> binomial)</span></code></pre></div>
<p>Note, that again <code>I()</code> is used, where the expression is evaluated on the fly, one could naturally also had made a vector of the classes.</p>
<p><em>Note, by default <code>glm()</code> will transform TRUE and FALSE to respectively 1 and 0.</em></p>
<p>Now we can make predictions.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="lab-section.html#cb22-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">=</span> <span class="fu">predict</span>(fit</span>
<span id="cb22-2"><a href="lab-section.html#cb22-2" aria-hidden="true" tabindex="-1"></a>                ,<span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age=</span>age.grid)</span>
<span id="cb22-3"><a href="lab-section.html#cb22-3" aria-hidden="true" tabindex="-1"></a>                ,<span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>To make confidence intevals for Pr(Y = 1|X), i.e.</p>
<p><span class="math display" id="eq:LogConfidenceinterval">\[\begin{equation}
Pr(Y=1|X)= \frac{exp(X\beta)}{1+exp(X\beta)}
\tag{2.5}
\end{equation}\]</span></p>
<p>Where <span class="math inline">\(X\beta\)</span> can be explained by:</p>
<p><span class="math display" id="eq:XBeta">\[\begin{equation}
log(\frac{Pr(Y=1|X)}{1-Pr(Y=1|X)})=X\beta
\tag{2.6}
\end{equation}\]</span></p>
<p>Hence we must first calculate <span class="math inline">\(X\beta\)</span> to find Pr(Y=1|X).</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="lab-section.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Prbabilities</span></span>
<span id="cb23-2"><a href="lab-section.html#cb23-2" aria-hidden="true" tabindex="-1"></a>pfit <span class="ot">=</span> <span class="fu">exp</span>(preds<span class="sc">$</span>fit)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(preds<span class="sc">$</span>fit)) <span class="co">#See equation above</span></span>
<span id="cb23-3"><a href="lab-section.html#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="lab-section.html#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#X beta</span></span>
<span id="cb23-5"><a href="lab-section.html#cb23-5" aria-hidden="true" tabindex="-1"></a>se.bands.logit <span class="ot">=</span> <span class="fu">cbind</span>(preds<span class="sc">$</span>fit<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>preds<span class="sc">$</span>se.fit <span class="co">#Upper level</span></span>
<span id="cb23-6"><a href="lab-section.html#cb23-6" aria-hidden="true" tabindex="-1"></a>                       ,preds<span class="sc">$</span>fit<span class="dv">-2</span><span class="sc">*</span>preds<span class="sc">$</span>se.fit) <span class="co">#Lower level</span></span>
<span id="cb23-7"><a href="lab-section.html#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="lab-section.html#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Pr(Y = 1|X)</span></span>
<span id="cb23-9"><a href="lab-section.html#cb23-9" aria-hidden="true" tabindex="-1"></a>se.bands <span class="ot">=</span> <span class="fu">exp</span>(se.bands.logit)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(se.bands.logit))</span></code></pre></div>
<p>Notice, that the posterior probabilities could also have been found by using <code>predict()</code>, see the following:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="lab-section.html#cb24-1" aria-hidden="true" tabindex="-1"></a>preds<span class="ot">=</span><span class="fu">predict</span> (fit</span>
<span id="cb24-2"><a href="lab-section.html#cb24-2" aria-hidden="true" tabindex="-1"></a>               ,<span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid)</span>
<span id="cb24-3"><a href="lab-section.html#cb24-3" aria-hidden="true" tabindex="-1"></a>               ,<span class="at">type =</span> <span class="st">&quot;response&quot;</span></span>
<span id="cb24-4"><a href="lab-section.html#cb24-4" aria-hidden="true" tabindex="-1"></a>               ,<span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><strong>NOTICE: for some reason this will lead to wrong confidence intervals <span class="citation">(<a href="references.html#ref-hastie2013" role="doc-biblioref">Hastie et al. 2013, 292</a>)</span></strong></p>
<p>Now we can make the right hand plot, so we can compare with continous result.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="lab-section.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb25-2"><a href="lab-section.html#cb25-2" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">3.1</span>,<span class="fl">4.5</span>,<span class="fl">4.5</span>,<span class="fl">1.1</span>) <span class="co">#Controls the margins</span></span>
<span id="cb25-3"><a href="lab-section.html#cb25-3" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="co">#Controls the margins</span></span>
<span id="cb25-4"><a href="lab-section.html#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Copy from earlier to combine plots</span></span>
<span id="cb25-5"><a href="lab-section.html#cb25-5" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age,<span class="dv">4</span>) <span class="co">#Orthogonal polynomials</span></span>
<span id="cb25-6"><a href="lab-section.html#cb25-6" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">data =</span> df)</span>
<span id="cb25-7"><a href="lab-section.html#cb25-7" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> fit</span>
<span id="cb25-8"><a href="lab-section.html#cb25-8" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid)</span>
<span id="cb25-9"><a href="lab-section.html#cb25-9" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-10"><a href="lab-section.html#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> df<span class="sc">$</span>age,<span class="at">y =</span> df<span class="sc">$</span>wage</span>
<span id="cb25-11"><a href="lab-section.html#cb25-11" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlim =</span> agelims</span>
<span id="cb25-12"><a href="lab-section.html#cb25-12" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">cex =</span> <span class="fl">0.5</span> <span class="co">#Size of dots</span></span>
<span id="cb25-13"><a href="lab-section.html#cb25-13" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb25-14"><a href="lab-section.html#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Degree-4 Polynomial&quot;</span>,<span class="at">outer =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-15"><a href="lab-section.html#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid,<span class="at">y =</span> preds<span class="sc">$</span>fit</span>
<span id="cb25-16"><a href="lab-section.html#cb25-16" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb25-17"><a href="lab-section.html#cb25-17" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb25-18"><a href="lab-section.html#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="lab-section.html#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">#The new plot</span></span>
<span id="cb25-20"><a href="lab-section.html#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> age,<span class="at">y =</span> <span class="fu">I</span>(wage <span class="sc">&gt;</span><span class="dv">250</span>)</span>
<span id="cb25-21"><a href="lab-section.html#cb25-21" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlim =</span> agelims</span>
<span id="cb25-22"><a href="lab-section.html#cb25-22" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">type =</span><span class="st">&quot;n&quot;</span></span>
<span id="cb25-23"><a href="lab-section.html#cb25-23" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">2</span>))</span>
<span id="cb25-24"><a href="lab-section.html#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="lab-section.html#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">jitter</span>(age)</span>
<span id="cb25-26"><a href="lab-section.html#cb25-26" aria-hidden="true" tabindex="-1"></a>       ,<span class="fu">I</span>((wage<span class="sc">&gt;</span><span class="dv">250</span>)<span class="sc">/</span><span class="dv">5</span>)</span>
<span id="cb25-27"><a href="lab-section.html#cb25-27" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">cex =</span> .<span class="dv">5</span></span>
<span id="cb25-28"><a href="lab-section.html#cb25-28" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">pch =</span> <span class="st">&quot;|&quot;</span></span>
<span id="cb25-29"><a href="lab-section.html#cb25-29" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb25-30"><a href="lab-section.html#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="lab-section.html#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid,<span class="at">y =</span> pfit</span>
<span id="cb25-32"><a href="lab-section.html#cb25-32" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb25-33"><a href="lab-section.html#cb25-33" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">col=</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb25-34"><a href="lab-section.html#cb25-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-35"><a href="lab-section.html#cb25-35" aria-hidden="true" tabindex="-1"></a><span class="fu">matlines</span>(<span class="at">x =</span> age.grid</span>
<span id="cb25-36"><a href="lab-section.html#cb25-36" aria-hidden="true" tabindex="-1"></a>         ,<span class="at">y =</span> se.bands</span>
<span id="cb25-37"><a href="lab-section.html#cb25-37" aria-hidden="true" tabindex="-1"></a>         ,<span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb25-38"><a href="lab-section.html#cb25-38" aria-hidden="true" tabindex="-1"></a>         ,<span class="at">col =</span> <span class="st">&quot;blue&quot;</span></span>
<span id="cb25-39"><a href="lab-section.html#cb25-39" aria-hidden="true" tabindex="-1"></a>         ,<span class="at">lty =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-23-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>We see on the right hand panel that the all the observations that have a wage above 250 is in the top and all those below hare in the bottom of the visualization.</p>
<p><code>jitter()</code> is merely an approach to avoid observations to overlap each other.</p>
</div>
<div id="step-function" class="section level4" number="2.2.1.3">
<h4><span class="header-section-number">2.2.1.3</span> Step function</h4>
<p>To fit the step function we must do:</p>
<ol style="list-style-type: decimal">
<li>Define the cuts, <code>cut()</code> is able to automatically pick cutpoints. One could also use <code>break()</code> to define where the cuts should be.</li>
<li>Train the model. Notice, that <code>lm()</code> will automatically create dummy variables for the ranges.</li>
</ol>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="lab-section.html#cb26-1" aria-hidden="true" tabindex="-1"></a>{<span class="fu">table</span>(<span class="fu">cut</span>(df<span class="sc">$</span>age,<span class="dv">4</span>)) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb26-2"><a href="lab-section.html#cb26-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">cut</span>(df<span class="sc">$</span>age,<span class="dv">4</span>)</span>
<span id="cb26-3"><a href="lab-section.html#cb26-3" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">data =</span> df)</span>
<span id="cb26-4"><a href="lab-section.html#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">summary</span>(fit)) <span class="sc">%&gt;%</span> <span class="fu">print</span>()}</span></code></pre></div>
<pre><code>## 
## (17.9,33.5]   (33.5,49]   (49,64.5] (64.5,80.1] 
##         750        1399         779          72 
##                            Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept)               94.158392   1.476069 63.789970 0.000000e+00
## cut(df$age, 4)(33.5,49]   24.053491   1.829431 13.148074 1.982315e-38
## cut(df$age, 4)(49,64.5]   23.664559   2.067958 11.443444 1.040750e-29
## cut(df$age, 4)(64.5,80.1]  7.640592   4.987424  1.531972 1.256350e-01</code></pre>
<p>We see that the p value of the cuts are significant.</p>
<p>Notice, that the first range is the base level, thus it is also left out. We can then use the intercept as the average wage for all in the range of up to 33.5 years.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="lab-section.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code></pre></div>
</div>
</div>
<div id="splines" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Splines</h3>
<p>The different approaches to splines are presented in the following.</p>
<div id="basis-function-splines" class="section level4" number="2.2.2.1">
<h4><span class="header-section-number">2.2.2.1</span> Basis Function Splines</h4>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="lab-section.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR)</span>
<span id="cb29-2"><a href="lab-section.html#cb29-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> Wage</span>
<span id="cb29-3"><a href="lab-section.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb29-4"><a href="lab-section.html#cb29-4" aria-hidden="true" tabindex="-1"></a>agelims <span class="ot">&lt;-</span> <span class="fu">range</span>(df<span class="sc">$</span>age) <span class="co">#The min and max</span></span>
<span id="cb29-5"><a href="lab-section.html#cb29-5" aria-hidden="true" tabindex="-1"></a>age.grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> agelims[<span class="dv">1</span>],<span class="at">to =</span> agelims[<span class="dv">2</span>]) <span class="co">#Creating a counter within the range</span></span></code></pre></div>
<p>The splines library contain what we need. We introduce the following functions:</p>
<ul>
<li><code>bs()</code>: Basis functions for splines. Generates entire matrix of basis functions for splines with the specified set of knots.</li>
<li><code>ns()</code>: Natural splines.</li>
<li><code>smooth.spline()</code>: Used when fitting smoothing splines.</li>
<li><code>loess()</code>: When fitting local regression.</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="lab-section.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb30-2"><a href="lab-section.html#cb30-2" aria-hidden="true" tabindex="-1"></a>fit.bs <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">bs</span>(age</span>
<span id="cb30-3"><a href="lab-section.html#cb30-3" aria-hidden="true" tabindex="-1"></a>                       ,<span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">40</span>,<span class="dv">60</span>)) <span class="co">#Note, degree is by default 3</span></span>
<span id="cb30-4"><a href="lab-section.html#cb30-4" aria-hidden="true" tabindex="-1"></a>             ,<span class="at">data =</span> df)</span>
<span id="cb30-5"><a href="lab-section.html#cb30-5" aria-hidden="true" tabindex="-1"></a>pred.bs <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.bs</span>
<span id="cb30-6"><a href="lab-section.html#cb30-6" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid)</span>
<span id="cb30-7"><a href="lab-section.html#cb30-7" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-8"><a href="lab-section.html#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df<span class="sc">$</span>age</span>
<span id="cb30-9"><a href="lab-section.html#cb30-9" aria-hidden="true" tabindex="-1"></a>     ,df<span class="sc">$</span>wage</span>
<span id="cb30-10"><a href="lab-section.html#cb30-10" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span> <span class="st">&quot;gray&quot;</span>)</span>
<span id="cb30-11"><a href="lab-section.html#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="lab-section.html#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid</span>
<span id="cb30-13"><a href="lab-section.html#cb30-13" aria-hidden="true" tabindex="-1"></a>      ,pred.bs<span class="sc">$</span>fit</span>
<span id="cb30-14"><a href="lab-section.html#cb30-14" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb30-15"><a href="lab-section.html#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="lab-section.html#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid</span>
<span id="cb30-17"><a href="lab-section.html#cb30-17" aria-hidden="true" tabindex="-1"></a>      ,pred.bs<span class="sc">$</span>fit<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>pred.bs<span class="sc">$</span>se</span>
<span id="cb30-18"><a href="lab-section.html#cb30-18" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb30-19"><a href="lab-section.html#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="lab-section.html#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid</span>
<span id="cb30-21"><a href="lab-section.html#cb30-21" aria-hidden="true" tabindex="-1"></a>      ,pred.bs<span class="sc">$</span>fit<span class="dv">-2</span><span class="sc">*</span>pred.bs<span class="sc">$</span>se</span>
<span id="cb30-22"><a href="lab-section.html#cb30-22" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb30-23"><a href="lab-section.html#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="lab-section.html#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Splines - Basis Functions&quot;</span>)</span></code></pre></div>
<p><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-27-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>We see that the splines have been fitted to the data and notice that the tails have wider confidence intervals.</p>
<p>We can get the amount of degrees of freedom by calling the <code>dim()</code>function.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="lab-section.html#cb31-1" aria-hidden="true" tabindex="-1"></a>{<span class="fu">dim</span>(<span class="fu">bs</span>(age</span>
<span id="cb31-2"><a href="lab-section.html#cb31-2" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">40</span>,<span class="dv">60</span>)) <span class="co">#Specifying the knots</span></span>
<span id="cb31-3"><a href="lab-section.html#cb31-3" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb31-4"><a href="lab-section.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(<span class="fu">bs</span>(age</span>
<span id="cb31-5"><a href="lab-section.html#cb31-5" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">df =</span> <span class="dv">6</span>) <span class="co">#df can be specified instead of knots</span></span>
<span id="cb31-6"><a href="lab-section.html#cb31-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb31-7"><a href="lab-section.html#cb31-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 3000    6
## [1] 3000    6</code></pre>
<p>We see that the two alternatives produce the same results</p>
<p>We can assess where the <code>bs()</code> placed the knots, by calling the <code>attr()</code>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="lab-section.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">bs</span>(age,<span class="at">df=</span><span class="dv">6</span>),<span class="st">&quot;knots&quot;</span>)</span></code></pre></div>
<pre><code>##   25%   50%   75% 
## 33.75 42.00 51.00</code></pre>
<p>In this case, R chose the 25%, 50% and 75% quantiles.</p>
</div>
<div id="natural-splines" class="section level4" number="2.2.2.2">
<h4><span class="header-section-number">2.2.2.2</span> Natural Splines</h4>
<p>The fitting procedure is the same, but now we just use <code>ns()</code> instead of <code>bs()</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="lab-section.html#cb35-1" aria-hidden="true" tabindex="-1"></a>fit.ns <span class="ot">=</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">ns</span>(age</span>
<span id="cb35-2"><a href="lab-section.html#cb35-2" aria-hidden="true" tabindex="-1"></a>                      ,<span class="at">df =</span> <span class="dv">4</span> <span class="co">#Note, as with bs() we could have specified the knots instead of.</span></span>
<span id="cb35-3"><a href="lab-section.html#cb35-3" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb35-4"><a href="lab-section.html#cb35-4" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">data =</span> df)</span>
<span id="cb35-5"><a href="lab-section.html#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="lab-section.html#cb35-6" aria-hidden="true" tabindex="-1"></a>pred.ns <span class="ot">=</span> <span class="fu">predict</span>(fit.ns</span>
<span id="cb35-7"><a href="lab-section.html#cb35-7" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age=</span>age.grid)</span>
<span id="cb35-8"><a href="lab-section.html#cb35-8" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-9"><a href="lab-section.html#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="lab-section.html#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Copy of old plot</span></span>
<span id="cb35-11"><a href="lab-section.html#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(df<span class="sc">$</span>age</span>
<span id="cb35-12"><a href="lab-section.html#cb35-12" aria-hidden="true" tabindex="-1"></a>       ,df<span class="sc">$</span>wage</span>
<span id="cb35-13"><a href="lab-section.html#cb35-13" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">col =</span> <span class="st">&quot;gray&quot;</span>)</span>
<span id="cb35-14"><a href="lab-section.html#cb35-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-15"><a href="lab-section.html#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(age.grid</span>
<span id="cb35-16"><a href="lab-section.html#cb35-16" aria-hidden="true" tabindex="-1"></a>        ,pred.bs<span class="sc">$</span>fit</span>
<span id="cb35-17"><a href="lab-section.html#cb35-17" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb35-18"><a href="lab-section.html#cb35-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-19"><a href="lab-section.html#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(age.grid</span>
<span id="cb35-20"><a href="lab-section.html#cb35-20" aria-hidden="true" tabindex="-1"></a>        ,pred.bs<span class="sc">$</span>fit<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>pred.bs<span class="sc">$</span>se</span>
<span id="cb35-21"><a href="lab-section.html#cb35-21" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb35-22"><a href="lab-section.html#cb35-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-23"><a href="lab-section.html#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(age.grid</span>
<span id="cb35-24"><a href="lab-section.html#cb35-24" aria-hidden="true" tabindex="-1"></a>        ,pred.bs<span class="sc">$</span>fit<span class="dv">-2</span><span class="sc">*</span>pred.bs<span class="sc">$</span>se</span>
<span id="cb35-25"><a href="lab-section.html#cb35-25" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb35-26"><a href="lab-section.html#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="lab-section.html#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding natural splines</span></span>
<span id="cb35-28"><a href="lab-section.html#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid</span>
<span id="cb35-29"><a href="lab-section.html#cb35-29" aria-hidden="true" tabindex="-1"></a>      ,pred.ns<span class="sc">$</span>fit</span>
<span id="cb35-30"><a href="lab-section.html#cb35-30" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">col =</span><span class="st">&quot;red&quot;</span></span>
<span id="cb35-31"><a href="lab-section.html#cb35-31" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lwd =</span><span class="dv">2</span>)</span>
<span id="cb35-32"><a href="lab-section.html#cb35-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-33"><a href="lab-section.html#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Splines - Basis Functions + Natural Splines&quot;</span>)</span>
<span id="cb35-34"><a href="lab-section.html#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,<span class="fu">c</span>(<span class="st">&quot;Basis&quot;</span>,<span class="st">&quot;Natural&quot;</span>),<span class="at">lty =</span> <span class="dv">1</span>,<span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;Black&quot;</span>,<span class="st">&quot;Red&quot;</span>),<span class="at">cex =</span> <span class="fl">0.6</span>)</span></code></pre></div>
<p><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-30-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="smooth-splines" class="section level4" number="2.2.2.3">
<h4><span class="header-section-number">2.2.2.3</span> Smooth Splines</h4>
<p>The code show the procedure.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="lab-section.html#cb36-1" aria-hidden="true" tabindex="-1"></a>fit.ss <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(<span class="at">x =</span> df<span class="sc">$</span>age,<span class="at">y =</span> df<span class="sc">$</span>wage</span>
<span id="cb36-2"><a href="lab-section.html#cb36-2" aria-hidden="true" tabindex="-1"></a>                     ,<span class="at">df =</span> <span class="dv">16</span>) <span class="co">#Remember that we must impose constraints</span></span>
<span id="cb36-3"><a href="lab-section.html#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="lab-section.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Choosing smoothing param with CV</span></span>
<span id="cb36-5"><a href="lab-section.html#cb36-5" aria-hidden="true" tabindex="-1"></a>fit.ss2 <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span> (df<span class="sc">$</span>age</span>
<span id="cb36-6"><a href="lab-section.html#cb36-6" aria-hidden="true" tabindex="-1"></a>                          ,df<span class="sc">$</span>wage</span>
<span id="cb36-7"><a href="lab-section.html#cb36-7" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">cv =</span> <span class="cn">TRUE</span>) <span class="co">#we choose cv instead of fixed amount of df</span></span>
<span id="cb36-8"><a href="lab-section.html#cb36-8" aria-hidden="true" tabindex="-1"></a>fit.ss2<span class="sc">$</span>df</span></code></pre></div>
<pre><code>## [1] 6.794596</code></pre>
<p>We get sparsity hence we have degrees of freedom of 6.8. That is due to the tuning parameter.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="lab-section.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(age,wage</span>
<span id="cb38-2"><a href="lab-section.html#cb38-2" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlim =</span> agelims</span>
<span id="cb38-3"><a href="lab-section.html#cb38-3" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">cex =</span> .<span class="dv">5</span></span>
<span id="cb38-4"><a href="lab-section.html#cb38-4" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb38-5"><a href="lab-section.html#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Smoothing Spline&quot;</span>)</span>
<span id="cb38-6"><a href="lab-section.html#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="lab-section.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.ss,<span class="at">col =</span> <span class="st">&quot;red&quot;</span>,<span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb38-8"><a href="lab-section.html#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.ss2,<span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,<span class="at">lwd =</span><span class="dv">2</span>)</span>
<span id="cb38-9"><a href="lab-section.html#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="lab-section.html#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,<span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;16 DF&quot;</span>,<span class="st">&quot;6.8 DF&quot;</span>)</span>
<span id="cb38-11"><a href="lab-section.html#cb38-11" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>)</span>
<span id="cb38-12"><a href="lab-section.html#cb38-12" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">lty =</span> <span class="dv">1</span></span>
<span id="cb38-13"><a href="lab-section.html#cb38-13" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb38-14"><a href="lab-section.html#cb38-14" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">cex =</span> .<span class="dv">8</span>)</span></code></pre></div>
<p><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-32-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>As expected, we see that the more complex model (highest amount of df) is the more flexible model.</p>
<p>Note: tuning parameter = <span class="math inline">\(\lambda\)</span>, where the CV seeks to choose the parameter that leads to the lowest error and return the df that leads to this level.</p>
</div>
<div id="local-regression-1" class="section level4" number="2.2.2.4">
<h4><span class="header-section-number">2.2.2.4</span> Local Regression</h4>
<p>Recall that local regression makes a linear regression for the observations that are close to the observation under evaluation (<span class="math inline">\(x_0\)</span>).</p>
<p>Thus we have to specify the span, the larger the span the smoother the fit, as we will include more observations.</p>
<p>NB: <code>locfit</code> library can also be used for fitting local regress</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="lab-section.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> df<span class="sc">$</span>age,<span class="at">y =</span> df<span class="sc">$</span>wage</span>
<span id="cb39-2"><a href="lab-section.html#cb39-2" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlim =</span> agelims</span>
<span id="cb39-3"><a href="lab-section.html#cb39-3" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">cex =</span> .<span class="dv">5</span></span>
<span id="cb39-4"><a href="lab-section.html#cb39-4" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb39-5"><a href="lab-section.html#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span> (<span class="st">&quot;Local Regression&quot;</span>)</span>
<span id="cb39-6"><a href="lab-section.html#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="lab-section.html#cb39-7" aria-hidden="true" tabindex="-1"></a>fit.lr <span class="ot">&lt;-</span> <span class="fu">loess</span>(wage <span class="sc">~</span> age</span>
<span id="cb39-8"><a href="lab-section.html#cb39-8" aria-hidden="true" tabindex="-1"></a>                ,<span class="at">span =</span> .<span class="dv">2</span> <span class="co">#Degree of smoothing / neighborhood to be included</span></span>
<span id="cb39-9"><a href="lab-section.html#cb39-9" aria-hidden="true" tabindex="-1"></a>                ,<span class="at">data =</span> df)</span>
<span id="cb39-10"><a href="lab-section.html#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="lab-section.html#cb39-11" aria-hidden="true" tabindex="-1"></a>fit.lr2 <span class="ot">&lt;-</span> <span class="fu">loess</span>(wage <span class="sc">~</span> age</span>
<span id="cb39-12"><a href="lab-section.html#cb39-12" aria-hidden="true" tabindex="-1"></a>              ,<span class="at">span =</span> .<span class="dv">5</span> <span class="co">#Degree of smoothing / neighborhood to be included</span></span>
<span id="cb39-13"><a href="lab-section.html#cb39-13" aria-hidden="true" tabindex="-1"></a>              ,<span class="at">data =</span> df)</span>
<span id="cb39-14"><a href="lab-section.html#cb39-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-15"><a href="lab-section.html#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid,<span class="at">y =</span> <span class="fu">predict</span>(<span class="at">object =</span> fit.lr,<span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age=</span>age.grid))</span>
<span id="cb39-16"><a href="lab-section.html#cb39-16" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">col =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb39-17"><a href="lab-section.html#cb39-17" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-18"><a href="lab-section.html#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="lab-section.html#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid,<span class="at">y =</span> <span class="fu">predict</span>(<span class="at">object =</span> fit.lr2,<span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age=</span>age.grid))</span>
<span id="cb39-20"><a href="lab-section.html#cb39-20" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">col =</span><span class="st">&quot; blue&quot;</span></span>
<span id="cb39-21"><a href="lab-section.html#cb39-21" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-22"><a href="lab-section.html#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="lab-section.html#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="st">&quot;topright&quot;</span></span>
<span id="cb39-24"><a href="lab-section.html#cb39-24" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Span = 0.2&quot;</span>,<span class="st">&quot;Span = 0.5&quot;</span>)</span>
<span id="cb39-25"><a href="lab-section.html#cb39-25" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>)</span>
<span id="cb39-26"><a href="lab-section.html#cb39-26" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">lty =</span> <span class="dv">1</span></span>
<span id="cb39-27"><a href="lab-section.html#cb39-27" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb39-28"><a href="lab-section.html#cb39-28" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">cex =</span> .<span class="dv">8</span>)</span></code></pre></div>
<p><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-33-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>From the plot we also see that the model with the largest span has the smoothest fit.</p>
</div>
</div>
<div id="gams" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> GAMs</h3>
<p>To be done</p>
<p><span class="citation">(<a href="references.html#ref-hastie2013" role="doc-biblioref">Hastie et al. 2013, 294</a>)</span></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="models-beyond-linearity.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercises.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
