<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.3 Lab section | Machine Learning for Business Intelligence 2</title>
  <meta name="description" content="2.3 Lab section | Machine Learning for Business Intelligence 2" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="2.3 Lab section | Machine Learning for Business Intelligence 2" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.3 Lab section | Machine Learning for Business Intelligence 2" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="lecture-notes.html"/>
<link rel="next" href="exercises.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>setup</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="moving-beyond-linearity.html"><a href="moving-beyond-linearity.html"><i class="fa fa-check"></i><b>2</b> Moving Beyond Linearity</a>
<ul>
<li class="chapter" data-level="2.1" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html"><i class="fa fa-check"></i><b>2.1</b> Models Beyond Linearity</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#polynomial-regression"><i class="fa fa-check"></i><b>2.1.1</b> Polynomial Regression</a>
<ul>
<li class="chapter" data-level="2.1.1.1" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#beta-coefficients-and-variance"><i class="fa fa-check"></i><b>2.1.1.1</b> Beta coefficients and variance</a></li>
<li class="chapter" data-level="2.1.1.2" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#application-procedure"><i class="fa fa-check"></i><b>2.1.1.2</b> Application procedure</a></li>
</ul></li>
<li class="chapter" data-level="2.1.2" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#step-functions"><i class="fa fa-check"></i><b>2.1.2</b> Step Functions</a></li>
<li class="chapter" data-level="2.1.3" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#regression-splines"><i class="fa fa-check"></i><b>2.1.3</b> Regression Splines</a>
<ul>
<li class="chapter" data-level="2.1.3.1" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#piecewise-polynomials"><i class="fa fa-check"></i><b>2.1.3.1</b> Piecewise Polynomials</a></li>
<li class="chapter" data-level="2.1.3.2" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#constraints-and-splines"><i class="fa fa-check"></i><b>2.1.3.2</b> Constraints and Splines</a></li>
<li class="chapter" data-level="2.1.3.3" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#choosing-the-number-and-location-of-the-knots"><i class="fa fa-check"></i><b>2.1.3.3</b> Choosing the number and location of the Knots</a></li>
<li class="chapter" data-level="2.1.3.4" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#degrees-of-freedom"><i class="fa fa-check"></i><b>2.1.3.4</b> Degrees of freedom</a></li>
<li class="chapter" data-level="2.1.3.5" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#comparison-with-polynomial-regression"><i class="fa fa-check"></i><b>2.1.3.5</b> Comparison with Polynomial Regression</a></li>
</ul></li>
<li class="chapter" data-level="2.1.4" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#smoothing-splines"><i class="fa fa-check"></i><b>2.1.4</b> Smoothing Splines</a>
<ul>
<li class="chapter" data-level="2.1.4.1" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#choosing-optimal-tuning-parameter"><i class="fa fa-check"></i><b>2.1.4.1</b> Choosing optimal tuning parameter</a></li>
</ul></li>
<li class="chapter" data-level="2.1.5" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#local-regression"><i class="fa fa-check"></i><b>2.1.5</b> Local Regression</a></li>
<li class="chapter" data-level="2.1.6" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#generalized-additive-models"><i class="fa fa-check"></i><b>2.1.6</b> Generalized Additive Models</a>
<ul>
<li class="chapter" data-level="2.1.6.1" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#feature-selection"><i class="fa fa-check"></i><b>2.1.6.1</b> Feature Selection</a></li>
<li class="chapter" data-level="2.1.6.2" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#gam-for-regression-problems"><i class="fa fa-check"></i><b>2.1.6.2</b> GAM for regression problems</a>
<ul>
<li class="chapter" data-level="2.1.6.2.1" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#interpretation-of-output"><i class="fa fa-check"></i><b>2.1.6.2.1</b> Interpretation of output</a></li>
</ul></li>
<li class="chapter" data-level="2.1.6.3" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#gam-for-classification-problems"><i class="fa fa-check"></i><b>2.1.6.3</b> GAM for classification problems</a></li>
</ul></li>
<li class="chapter" data-level="2.1.7" data-path="models-beyond-linearity.html"><a href="models-beyond-linearity.html#model-assessment"><i class="fa fa-check"></i><b>2.1.7</b> Model assessment</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="lecture-notes.html"><a href="lecture-notes.html"><i class="fa fa-check"></i><b>2.2</b> Lecture notes</a></li>
<li class="chapter" data-level="2.3" data-path="lab-section.html"><a href="lab-section.html"><i class="fa fa-check"></i><b>2.3</b> Lab section</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="lab-section.html"><a href="lab-section.html#polynomial-regression-and-step-functions"><i class="fa fa-check"></i><b>2.3.1</b> Polynomial Regression and Step Functions</a>
<ul>
<li class="chapter" data-level="2.3.1.1" data-path="lab-section.html"><a href="lab-section.html#continous-model"><i class="fa fa-check"></i><b>2.3.1.1</b> Continous model</a></li>
<li class="chapter" data-level="2.3.1.2" data-path="lab-section.html"><a href="lab-section.html#logarithmic-model"><i class="fa fa-check"></i><b>2.3.1.2</b> Logarithmic model</a></li>
<li class="chapter" data-level="2.3.1.3" data-path="lab-section.html"><a href="lab-section.html#step-function"><i class="fa fa-check"></i><b>2.3.1.3</b> Step function</a></li>
</ul></li>
<li class="chapter" data-level="2.3.2" data-path="lab-section.html"><a href="lab-section.html#splines"><i class="fa fa-check"></i><b>2.3.2</b> Splines</a>
<ul>
<li class="chapter" data-level="2.3.2.1" data-path="lab-section.html"><a href="lab-section.html#basis-function-splines"><i class="fa fa-check"></i><b>2.3.2.1</b> Basis Function Splines</a></li>
<li class="chapter" data-level="2.3.2.2" data-path="lab-section.html"><a href="lab-section.html#natural-splines"><i class="fa fa-check"></i><b>2.3.2.2</b> Natural Splines</a></li>
<li class="chapter" data-level="2.3.2.3" data-path="lab-section.html"><a href="lab-section.html#smooth-splines"><i class="fa fa-check"></i><b>2.3.2.3</b> Smooth Splines</a></li>
<li class="chapter" data-level="2.3.2.4" data-path="lab-section.html"><a href="lab-section.html#local-regression-1"><i class="fa fa-check"></i><b>2.3.2.4</b> Local Regression</a></li>
</ul></li>
<li class="chapter" data-level="2.3.3" data-path="lab-section.html"><a href="lab-section.html#gams"><i class="fa fa-check"></i><b>2.3.3</b> GAMs</a>
<ul>
<li class="chapter" data-level="2.3.3.1" data-path="lab-section.html"><a href="lab-section.html#with-only-natural-splines"><i class="fa fa-check"></i><b>2.3.3.1</b> With only natural splines</a></li>
<li class="chapter" data-level="2.3.3.2" data-path="lab-section.html"><a href="lab-section.html#with-different-splines"><i class="fa fa-check"></i><b>2.3.3.2</b> With different splines</a></li>
<li class="chapter" data-level="2.3.3.3" data-path="lab-section.html"><a href="lab-section.html#but-what-variables-to-include"><i class="fa fa-check"></i><b>2.3.3.3</b> But what variables to include?</a></li>
<li class="chapter" data-level="2.3.3.4" data-path="lab-section.html"><a href="lab-section.html#gam-with-local-regression"><i class="fa fa-check"></i><b>2.3.3.4</b> GAM with local regression</a></li>
<li class="chapter" data-level="2.3.3.5" data-path="lab-section.html"><a href="lab-section.html#logistic-regression"><i class="fa fa-check"></i><b>2.3.3.5</b> Logistic Regression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>2.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="exercises.html"><a href="exercises.html#exercise-6"><i class="fa fa-check"></i><b>2.4.1</b> Exercise 6</a>
<ul>
<li class="chapter" data-level="2.4.1.1" data-path="exercises.html"><a href="exercises.html#a-polynomial-regression"><i class="fa fa-check"></i><b>2.4.1.1</b> 6.a Polynomial Regression</a></li>
<li class="chapter" data-level="2.4.1.2" data-path="exercises.html"><a href="exercises.html#b-step-function"><i class="fa fa-check"></i><b>2.4.1.2</b> 6.b Step function</a></li>
</ul></li>
<li class="chapter" data-level="2.4.2" data-path="exercises.html"><a href="exercises.html#exercise-7"><i class="fa fa-check"></i><b>2.4.2</b> Exercise 7</a></li>
<li class="chapter" data-level="2.4.3" data-path="exercises.html"><a href="exercises.html#exercise-8"><i class="fa fa-check"></i><b>2.4.3</b> Exercise 8</a></li>
<li class="chapter" data-level="2.4.4" data-path="exercises.html"><a href="exercises.html#exercise-9"><i class="fa fa-check"></i><b>2.4.4</b> Exercise 9</a>
<ul>
<li class="chapter" data-level="2.4.4.1" data-path="exercises.html"><a href="exercises.html#a-using-poly-function-to-fit-cubic-polynomial-regression"><i class="fa fa-check"></i><b>2.4.4.1</b> (a) using poly function to fit cubic polynomial regression</a></li>
<li class="chapter" data-level="2.4.4.2" data-path="exercises.html"><a href="exercises.html#b-plotting-polynomial-fits-for-a-range-of-polynomials"><i class="fa fa-check"></i><b>2.4.4.2</b> (b) Plotting polynomial fits for a range of polynomials</a></li>
<li class="chapter" data-level="2.4.4.3" data-path="exercises.html"><a href="exercises.html#c-using-cv-to-select-best-degree-of-d"><i class="fa fa-check"></i><b>2.4.4.3</b> (c) Using CV to select best degree of d</a></li>
<li class="chapter" data-level="2.4.4.4" data-path="exercises.html"><a href="exercises.html#d-use-bs-to-fit-a-regression-spline"><i class="fa fa-check"></i><b>2.4.4.4</b> (d) Use <code>bs()</code> to fit a regression spline</a></li>
<li class="chapter" data-level="2.4.4.5" data-path="exercises.html"><a href="exercises.html#e-now-fit-a-regression-spline"><i class="fa fa-check"></i><b>2.4.4.5</b> (e) Now fit a regression spline</a></li>
<li class="chapter" data-level="2.4.4.6" data-path="exercises.html"><a href="exercises.html#f-perform-cross-validation-to-select-degrees"><i class="fa fa-check"></i><b>2.4.4.6</b> (f) Perform cross-validation, to select degrees</a></li>
</ul></li>
<li class="chapter" data-level="2.4.5" data-path="exercises.html"><a href="exercises.html#exercise-10"><i class="fa fa-check"></i><b>2.4.5</b> Exercise 10</a>
<ul>
<li class="chapter" data-level="2.4.5.1" data-path="exercises.html"><a href="exercises.html#a-partitioning-the-data"><i class="fa fa-check"></i><b>2.4.5.1</b> (a) Partitioning the data</a></li>
<li class="chapter" data-level="2.4.5.2" data-path="exercises.html"><a href="exercises.html#b-fitting-a-gam"><i class="fa fa-check"></i><b>2.4.5.2</b> (b) Fitting a GAM</a></li>
<li class="chapter" data-level="2.4.5.3" data-path="exercises.html"><a href="exercises.html#c-evaluating-on-the-test-set"><i class="fa fa-check"></i><b>2.4.5.3</b> (c) Evaluating on the test set</a></li>
<li class="chapter" data-level="2.4.5.4" data-path="exercises.html"><a href="exercises.html#d-which-variables-appear-to-have-a-non-linear-relationship"><i class="fa fa-check"></i><b>2.4.5.4</b> (d) Which variables appear to have a non linear relationship?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="FacebookCasestudy.html"><a href="FacebookCasestudy.html"><i class="fa fa-check"></i><b>2.5</b> Predicting the Return on Advertising Spent</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="FacebookCasestudy.html"><a href="FacebookCasestudy.html#background"><i class="fa fa-check"></i><b>2.5.1</b> 1. Background</a></li>
<li class="chapter" data-level="2.5.2" data-path="FacebookCasestudy.html"><a href="FacebookCasestudy.html#case-study-business-understanding-phase"><i class="fa fa-check"></i><b>2.5.2</b> 2. Case study (Business Understanding Phase)</a></li>
<li class="chapter" data-level="2.5.3" data-path="FacebookCasestudy.html"><a href="FacebookCasestudy.html#the-data-data-understanding-phase"><i class="fa fa-check"></i><b>2.5.3</b> 3. The data (Data Understanding Phase)</a></li>
<li class="chapter" data-level="2.5.4" data-path="FacebookCasestudy.html"><a href="FacebookCasestudy.html#specific-requirements"><i class="fa fa-check"></i><b>2.5.4</b> 4. Specific requirements:</a>
<ul>
<li class="chapter" data-level="2.5.4.1" data-path="FacebookCasestudy.html"><a href="FacebookCasestudy.html#task-1---import-and-overview"><i class="fa fa-check"></i><b>2.5.4.1</b> 4.1 Task 1 - Import and overview</a></li>
<li class="chapter" data-level="2.5.4.2" data-path="FacebookCasestudy.html"><a href="FacebookCasestudy.html#task-2---data-inspection"><i class="fa fa-check"></i><b>2.5.4.2</b> 4.2 Task 2 - Data inspection</a></li>
<li class="chapter" data-level="2.5.4.3" data-path="FacebookCasestudy.html"><a href="FacebookCasestudy.html#task-3---building-different-models"><i class="fa fa-check"></i><b>2.5.4.3</b> 4.3 Task 3 - Building different models</a>
<ul>
<li class="chapter" data-level="2.5.4.3.1" data-path="FacebookCasestudy.html"><a href="FacebookCasestudy.html#a-generalized-additive-model-gam-to-predict-roas"><i class="fa fa-check"></i><b>2.5.4.3.1</b> A Generalized Additive Model (GAM) to predict ROAS</a>
<ul>
<li class="chapter" data-level="2.5.4.3.1.1" data-path="FacebookCasestudy.html"><a href="FacebookCasestudy.html#c1-feature-selection-using-regsubsets"><i class="fa fa-check"></i><b>2.5.4.3.1.1</b> c1) Feature selection using regsubsets()</a></li>
<li class="chapter" data-level="2.5.4.3.1.2" data-path="FacebookCasestudy.html"><a href="FacebookCasestudy.html#c2-feature-selection-using-step.gam"><i class="fa fa-check"></i><b>2.5.4.3.1.2</b> c2) Feature selection using step.GAM</a></li>
<li class="chapter" data-level="2.5.4.3.1.3" data-path="FacebookCasestudy.html"><a href="FacebookCasestudy.html#c3-fetaure-selection-using-random-forest"><i class="fa fa-check"></i><b>2.5.4.3.1.3</b> c3) Fetaure selection using random forest</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tree-based-methods.html"><a href="tree-based-methods.html"><i class="fa fa-check"></i><b>3</b> Tree Based Methods</a>
<ul>
<li class="chapter" data-level="3.1" data-path="the-basics-of-decision-trees.html"><a href="the-basics-of-decision-trees.html"><i class="fa fa-check"></i><b>3.1</b> The Basics of Decision Trees</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="the-basics-of-decision-trees.html"><a href="the-basics-of-decision-trees.html#regression-trees"><i class="fa fa-check"></i><b>3.1.1</b> Regression Trees</a>
<ul>
<li class="chapter" data-level="3.1.1.1" data-path="the-basics-of-decision-trees.html"><a href="the-basics-of-decision-trees.html#how-to-make-the-decision-trees"><i class="fa fa-check"></i><b>3.1.1.1</b> How to make the decision trees</a>
<ul>
<li class="chapter" data-level="3.1.1.1.1" data-path="the-basics-of-decision-trees.html"><a href="the-basics-of-decision-trees.html#the-goal-of-regression"><i class="fa fa-check"></i><b>3.1.1.1.1</b> The goal of regression</a></li>
<li class="chapter" data-level="3.1.1.1.2" data-path="the-basics-of-decision-trees.html"><a href="the-basics-of-decision-trees.html#tree-pruning-algoritm"><i class="fa fa-check"></i><b>3.1.1.1.2</b> Tree Pruning &amp; Algoritm</a></li>
<li class="chapter" data-level="3.1.1.1.3" data-path="the-basics-of-decision-trees.html"><a href="the-basics-of-decision-trees.html#setting-contrains-of-the-tree-sise"><i class="fa fa-check"></i><b>3.1.1.1.3</b> Setting contrains of the tree sise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3.1.2" data-path="the-basics-of-decision-trees.html"><a href="the-basics-of-decision-trees.html#classification-trees"><i class="fa fa-check"></i><b>3.1.2</b> Classification Trees</a></li>
<li class="chapter" data-level="3.1.3" data-path="the-basics-of-decision-trees.html"><a href="the-basics-of-decision-trees.html#tree-vs.-lienar-models"><i class="fa fa-check"></i><b>3.1.3</b> Tree vs. Lienar Models</a></li>
<li class="chapter" data-level="3.1.4" data-path="the-basics-of-decision-trees.html"><a href="the-basics-of-decision-trees.html#advantages-and-disadvantages-of-trees"><i class="fa fa-check"></i><b>3.1.4</b> Advantages and Disadvantages of Trees</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="bagging-random-forests-boosting.html"><a href="bagging-random-forests-boosting.html"><i class="fa fa-check"></i><b>3.2</b> Bagging, Random Forests, Boosting</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="bagging-random-forests-boosting.html"><a href="bagging-random-forests-boosting.html#bagging-bootstrap-aggregation"><i class="fa fa-check"></i><b>3.2.1</b> Bagging (Bootstrap Aggregation)</a></li>
<li class="chapter" data-level="3.2.2" data-path="bagging-random-forests-boosting.html"><a href="bagging-random-forests-boosting.html#random-forests"><i class="fa fa-check"></i><b>3.2.2</b> Random Forests</a></li>
<li class="chapter" data-level="3.2.3" data-path="bagging-random-forests-boosting.html"><a href="bagging-random-forests-boosting.html#boosting"><i class="fa fa-check"></i><b>3.2.3</b> Boosting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="subject-1.html"><a href="subject-1.html"><i class="fa fa-check"></i><b>4</b> Subject 1</a></li>
<li class="chapter" data-level="5" data-path="subject-1-1.html"><a href="subject-1-1.html"><i class="fa fa-check"></i><b>5</b> Subject 1</a></li>
<li class="chapter" data-level="6" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>6</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Machine Learning for Business Intelligence 2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lab-section" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Lab section</h2>
<p>Loading the data that will be used throughout the lab section.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="lab-section.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR)</span>
<span id="cb4-2"><a href="lab-section.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(Wage)</span>
<span id="cb4-3"><a href="lab-section.html#cb4-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> Wage</span></code></pre></div>
<p><br />
</p>
<div id="polynomial-regression-and-step-functions" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Polynomial Regression and Step Functions</h3>
<div id="continous-model" class="section level4" number="2.3.1.1">
<h4><span class="header-section-number">2.3.1.1</span> Continous model</h4>
<p>Fitting the model:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="lab-section.html#cb5-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age,<span class="dv">4</span>) <span class="co">#Orthogonal polynomials</span></span>
<span id="cb5-2"><a href="lab-section.html#cb5-2" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">data =</span> df)</span>
<span id="cb5-3"><a href="lab-section.html#cb5-3" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age,<span class="dv">4</span>,<span class="at">raw =</span> <span class="cn">TRUE</span>) <span class="co">#Orthogonal polynomials</span></span>
<span id="cb5-4"><a href="lab-section.html#cb5-4" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">data =</span> df)</span></code></pre></div>
<p>Note: <code>poly()</code> returns orthogonal polynomials, which is some linear combination of the variables to the d power. See the following two examples when using orthogonal and normal polynomials:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="lab-section.html#cb6-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb6-2"><a href="lab-section.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Orthogonal&quot;</span>)</span>
<span id="cb6-3"><a href="lab-section.html#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(df<span class="sc">$</span>age,<span class="fu">poly</span>(<span class="at">x =</span> df<span class="sc">$</span>age,<span class="at">degree =</span> <span class="dv">4</span>))[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]  <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb6-4"><a href="lab-section.html#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Regular&quot;</span>)</span>
<span id="cb6-5"><a href="lab-section.html#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(df<span class="sc">$</span>age,<span class="fu">poly</span>(<span class="at">x =</span> df<span class="sc">$</span>age,<span class="at">degree =</span> <span class="dv">4</span>,<span class="at">raw =</span> <span class="cn">TRUE</span>))[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,] <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb6-6"><a href="lab-section.html#cb6-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;Orthogonal&quot;
##                     1            2             3           4
## [1,] 18 -0.0386247992  0.055908727 -0.0717405794  0.08672985
## [2,] 24 -0.0291326034  0.026298066 -0.0145499511 -0.00259928
## [3,] 45  0.0040900817 -0.014506548 -0.0001331835  0.01448009
## [4,] 43  0.0009260164 -0.014831404  0.0045136682  0.01265751
## [5,] 50  0.0120002448 -0.009815846 -0.0111366263  0.01021146
## [1] &quot;Regular&quot;
##          1    2      3       4
## [1,] 18 18  324   5832  104976
## [2,] 24 24  576  13824  331776
## [3,] 45 45 2025  91125 4100625
## [4,] 43 43 1849  79507 3418801
## [5,] 50 50 2500 125000 6250000</code></pre>
<p>In the end, it does not have a noticeable effect.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="lab-section.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">5</span>)</span>
<span id="cb8-2"><a href="lab-section.html#cb8-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-3"><a href="lab-section.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(<span class="fu">summary</span>(fit)) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb8-4"><a href="lab-section.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(<span class="fu">summary</span>(fit2)) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb8-5"><a href="lab-section.html#cb8-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>##                 Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept)    111.70361  0.7287409 153.283015 0.000000e+00
## poly(age, 4)1  447.06785 39.9147851  11.200558 1.484604e-28
## poly(age, 4)2 -478.31581 39.9147851 -11.983424 2.355831e-32
## poly(age, 4)3  125.52169 39.9147851   3.144742 1.678622e-03
## poly(age, 4)4  -77.91118 39.9147851  -1.951938 5.103865e-02
##                                  Estimate     Std. Error   t value     Pr(&gt;|t|)
## (Intercept)               -184.1541797743 60.04037718327 -3.067172 0.0021802539
## poly(age, 4, raw = TRUE)1   21.2455205321  5.88674824448  3.609042 0.0003123618
## poly(age, 4, raw = TRUE)2   -0.5638593126  0.20610825640 -2.735743 0.0062606446
## poly(age, 4, raw = TRUE)3    0.0068106877  0.00306593115  2.221409 0.0263977518
## poly(age, 4, raw = TRUE)4   -0.0000320383  0.00001641359 -1.951938 0.0510386498</code></pre>
<p>Even though the coefficients are different and the p-values hereof, the fitted values will be indistinguishable <span class="citation">(<a href="references.html#ref-hastie2013" role="doc-biblioref">Hastie et al. 2013, 288</a>)</span>. This is also shown later.</p>
<p><em>Alternatives to using <code>poly()</code>??</em></p>
<p>We have two alternatives:</p>
<ol style="list-style-type: decimal">
<li><p>Using <code>I()</code></p></li>
<li><p>Using <code>cbind()</code></p></li>
<li><p>Using <code>I()</code></p></li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="lab-section.html#cb10-1" aria-hidden="true" tabindex="-1"></a>fit2a <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">4</span>) <span class="co">#Note that &#39;I()&#39; is added</span></span>
<span id="cb10-2"><a href="lab-section.html#cb10-2" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">data =</span> df)</span>
<span id="cb10-3"><a href="lab-section.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit2a)</span></code></pre></div>
<pre><code>##     (Intercept)             age        I(age^2)        I(age^3)        I(age^4) 
## -184.1541797743   21.2455205321   -0.5638593126    0.0068106877   -0.0000320383</code></pre>
<p><em>Notice <code>I()</code> as ‘^’ has another special meaning in formulas</em></p>
<p>Hence we see that the coefficients are the same.</p>
<ol start="2" style="list-style-type: decimal">
<li>Using <code>cbind()</code></li>
</ol>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="lab-section.html#cb12-1" aria-hidden="true" tabindex="-1"></a>fit2b <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">cbind</span>(age,age<span class="sc">^</span><span class="dv">2</span>,age<span class="sc">^</span><span class="dv">3</span>,age<span class="sc">^</span><span class="dv">4</span>)</span>
<span id="cb12-2"><a href="lab-section.html#cb12-2" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">data =</span> df)</span>
<span id="cb12-3"><a href="lab-section.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit2b)</span></code></pre></div>
<pre><code>##                        (Intercept) cbind(age, age^2, age^3, age^4)age 
##                    -184.1541797743                      21.2455205321 
##    cbind(age, age^2, age^3, age^4)    cbind(age, age^2, age^3, age^4) 
##                      -0.5638593126                       0.0068106877 
##    cbind(age, age^2, age^3, age^4) 
##                      -0.0000320383</code></pre>
<p>We see that we are now able to use ‘^’ within the <code>cbind()</code>.</p>
<p><br />
</p>
<p>proceeding with the lab sections. We can now present a grid of values for age, at which we want predictions and then call the <code>predict()</code> and also plot the standard errors.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="lab-section.html#cb14-1" aria-hidden="true" tabindex="-1"></a>agelims <span class="ot">&lt;-</span> <span class="fu">range</span>(df<span class="sc">$</span>age) <span class="co">#The min and max</span></span>
<span id="cb14-2"><a href="lab-section.html#cb14-2" aria-hidden="true" tabindex="-1"></a>age.grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> agelims[<span class="dv">1</span>],<span class="at">to =</span> agelims[<span class="dv">2</span>]) <span class="co">#Creating a counter within the range</span></span>
<span id="cb14-3"><a href="lab-section.html#cb14-3" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> fit</span>
<span id="cb14-4"><a href="lab-section.html#cb14-4" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid) <span class="co">#Creating a list with the counter named age, so it fits the IV naming</span></span>
<span id="cb14-5"><a href="lab-section.html#cb14-5" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-6"><a href="lab-section.html#cb14-6" aria-hidden="true" tabindex="-1"></a>se.bands <span class="ot">&lt;-</span> <span class="fu">cbind</span>(preds<span class="sc">$</span>fit <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>preds<span class="sc">$</span>se.fit <span class="co">#Upper band</span></span>
<span id="cb14-7"><a href="lab-section.html#cb14-7" aria-hidden="true" tabindex="-1"></a>                  ,preds<span class="sc">$</span>fit<span class="dv">-2</span><span class="sc">*</span>preds<span class="sc">$</span>se.fit) <span class="co">#Lower band</span></span></code></pre></div>
<p>Notice that 2 SE (2 sd) = 95%, hence we expect to contain 95% of the data within confidence levels.</p>
<p>Now we can plot the data</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="lab-section.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> df<span class="sc">$</span>age,<span class="at">y =</span> df<span class="sc">$</span>wage</span>
<span id="cb15-2"><a href="lab-section.html#cb15-2" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlim =</span> agelims</span>
<span id="cb15-3"><a href="lab-section.html#cb15-3" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">cex =</span> <span class="fl">0.5</span> <span class="co">#Size of dots</span></span>
<span id="cb15-4"><a href="lab-section.html#cb15-4" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb15-5"><a href="lab-section.html#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Degree-4 Polynomial&quot;</span>,<span class="at">outer =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-6"><a href="lab-section.html#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid,<span class="at">y =</span> preds<span class="sc">$</span>fit</span>
<span id="cb15-7"><a href="lab-section.html#cb15-7" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb15-8"><a href="lab-section.html#cb15-8" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-15-1.png" width="720" style="display: block; margin: auto;" /></p>
<p><strong><em>Comparison between raw polynomials and orthogonal polynomials</em></strong></p>
<p>With the following we see that the difference of the fitted values are practically 0.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="lab-section.html#cb16-1" aria-hidden="true" tabindex="-1"></a>preds2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> fit2</span>
<span id="cb16-2"><a href="lab-section.html#cb16-2" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid)</span>
<span id="cb16-3"><a href="lab-section.html#cb16-3" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-4"><a href="lab-section.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">abs</span>(preds<span class="sc">$</span>fit<span class="sc">-</span>preds2<span class="sc">$</span>fit))</span></code></pre></div>
<pre><code>## [1] 7.81597e-11</code></pre>
<p>In terms of predictions, the two approaches are more or less the same, although the orthogonal polynomials removes some effect of collinearity.</p>
<p><br />
</p>
<hr />
<p><strong>Assessing what polynomial to include</strong></p>
<p>Now we can compare models with different orthogonal polynomials. Using ANOVA, which compare the RSS to see if the decrease in RSS is significant.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="lab-section.html#cb18-1" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage<span class="sc">~</span>age,<span class="at">data=</span>df)</span>
<span id="cb18-2"><a href="lab-section.html#cb18-2" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage<span class="sc">~</span><span class="fu">poly</span>(df<span class="sc">$</span>age,<span class="dv">2</span>),<span class="at">data=</span>df)</span>
<span id="cb18-3"><a href="lab-section.html#cb18-3" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage<span class="sc">~</span><span class="fu">poly</span>(df<span class="sc">$</span>age,<span class="dv">3</span>),<span class="at">data=</span>df)</span>
<span id="cb18-4"><a href="lab-section.html#cb18-4" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage<span class="sc">~</span><span class="fu">poly</span>(df<span class="sc">$</span>age,<span class="dv">4</span>),<span class="at">data=</span>df)</span>
<span id="cb18-5"><a href="lab-section.html#cb18-5" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage<span class="sc">~</span><span class="fu">poly</span>(df<span class="sc">$</span>age,<span class="dv">5</span>),<span class="at">data=</span>df)</span>
<span id="cb18-6"><a href="lab-section.html#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit<span class="fl">.1</span>,fit<span class="fl">.2</span>,fit<span class="fl">.3</span>,fit<span class="fl">.4</span>,fit<span class="fl">.5</span>)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">Res.Df</th>
<th align="right">RSS</th>
<th align="right">Df</th>
<th align="right">Sum of Sq</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2998</td>
<td align="right">5022216</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">2997</td>
<td align="right">4793430</td>
<td align="right">1</td>
<td align="right">228786.010</td>
<td align="right">143.5931074</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="right">2996</td>
<td align="right">4777674</td>
<td align="right">1</td>
<td align="right">15755.694</td>
<td align="right">9.8887559</td>
<td align="right">0.0016792</td>
</tr>
<tr class="even">
<td align="right">2995</td>
<td align="right">4771604</td>
<td align="right">1</td>
<td align="right">6070.152</td>
<td align="right">3.8098134</td>
<td align="right">0.0510462</td>
</tr>
<tr class="odd">
<td align="right">2994</td>
<td align="right">4770322</td>
<td align="right">1</td>
<td align="right">1282.563</td>
<td align="right">0.8049758</td>
<td align="right">0.3696820</td>
</tr>
</tbody>
</table>
</div>
<p><em>Note, </em></p>
<ul>
<li><em>the anova compares the sum of resduals squared.</em></li>
<li><em>the anova follows an F distribution, hence we could apple the critical values</em></li>
</ul>
<p>based on the anova we see that the errors change significantly until the 5th degree, hence the decision should be to take the model with order 4 of polynomials.</p>
<p>Notice, that the model will never become worse in sample when complexity is added, as we fit the model more to the data.</p>
<p><em>Alternative</em></p>
<p>We could also have obtained the same output using <code>coef()</code> instead of the anove, where we see that teh p-values are the same, also the squared value of t (<span class="math inline">\(t^2=F\)</span>).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="lab-section.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">summary</span>(fit<span class="fl">.5</span>))</span></code></pre></div>
<pre><code>##                    Estimate Std. Error     t value     Pr(&gt;|t|)
## (Intercept)       111.70361  0.7287647 153.2780243 0.000000e+00
## poly(df$age, 5)1  447.06785 39.9160847  11.2001930 1.491111e-28
## poly(df$age, 5)2 -478.31581 39.9160847 -11.9830341 2.367734e-32
## poly(df$age, 5)3  125.52169 39.9160847   3.1446392 1.679213e-03
## poly(df$age, 5)4  -77.91118 39.9160847  -1.9518743 5.104623e-02
## poly(df$age, 5)5  -35.81289 39.9160847  -0.8972045 3.696820e-01</code></pre>
<p><em>Notice: this is only an alternative when we exclusively have polynomials in the model!</em></p>
<hr />
<p><br />
</p>
<p><strong>Using ANOVA to assess for best models</strong></p>
<p>The following is another example of using ANOVA where different variables are used:</p>
<p>And recall, that we should never apply p-values of variables in a model, to decide which that should be included.</p>
<p><strong>NOTE; this approach only works when the models are nested, meanin that the overall variables are the same, hence M2 could not have regian for instance, they all need to have the same overall variable</strong></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="lab-section.html#cb21-1" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">lm</span>(wage<span class="sc">~</span>education <span class="sc">+</span>age ,<span class="at">data=</span>df)</span>
<span id="cb21-2"><a href="lab-section.html#cb21-2" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.2</span> <span class="ot">=</span> <span class="fu">lm</span>(wage<span class="sc">~</span>education <span class="sc">+</span><span class="fu">poly</span>(age ,<span class="dv">2</span>) ,<span class="at">data=</span>df)</span>
<span id="cb21-3"><a href="lab-section.html#cb21-3" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.3</span> <span class="ot">=</span> <span class="fu">lm</span>(wage<span class="sc">~</span>education <span class="sc">+</span><span class="fu">poly</span>(age ,<span class="dv">3</span>) ,<span class="at">data=</span>df)</span>
<span id="cb21-4"><a href="lab-section.html#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit<span class="fl">.1</span>,fit<span class="fl">.2</span>,fit<span class="fl">.3</span>)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">Res.Df</th>
<th align="right">RSS</th>
<th align="right">Df</th>
<th align="right">Sum of Sq</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2994</td>
<td align="right">3867992</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">2993</td>
<td align="right">3725395</td>
<td align="right">1</td>
<td align="right">142597.10</td>
<td align="right">114.696898</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="right">2992</td>
<td align="right">3719809</td>
<td align="right">1</td>
<td align="right">5586.66</td>
<td align="right">4.493588</td>
<td align="right">0.0341043</td>
</tr>
</tbody>
</table>
</div>
<p>What are we looking for?</p>
<ol style="list-style-type: decimal">
<li>What model lowers the RSS significantly.</li>
</ol>
<p><strong>Using CV</strong></p>
<p>We could also have chosen the order of polynomials using cross validation.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="lab-section.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb22-2"><a href="lab-section.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">19</span>)</span>
<span id="cb22-3"><a href="lab-section.html#cb22-3" aria-hidden="true" tabindex="-1"></a>cv.error <span class="ot">=</span> <span class="fu">rep</span> (<span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb22-4"><a href="lab-section.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb22-5"><a href="lab-section.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb22-6"><a href="lab-section.html#cb22-6" aria-hidden="true" tabindex="-1"></a>  fit.i<span class="ot">=</span><span class="fu">glm</span>(wage<span class="sc">~</span><span class="fu">poly</span>(age,i),<span class="at">data=</span>Wage)  <span class="co"># notice glm here in conjunction with cv.glm function</span></span>
<span id="cb22-7"><a href="lab-section.html#cb22-7" aria-hidden="true" tabindex="-1"></a>  cv.error[i]<span class="ot">=</span><span class="fu">cv.glm</span>(Wage, fit.i, <span class="at">K=</span><span class="dv">10</span>)<span class="sc">$</span>delta[<span class="dv">1</span>] <span class="co">#K fold CV</span></span>
<span id="cb22-8"><a href="lab-section.html#cb22-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-9"><a href="lab-section.html#cb22-9" aria-hidden="true" tabindex="-1"></a>cv.error <span class="co"># the CV errors of the five polynomials models</span></span></code></pre></div>
<pre><code>## [1] 1674.979 1600.176 1595.913 1594.003 1596.304</code></pre>
<p>Concl: A 5 order model is not justified as the it starts increasing. Also we see that the 4th order d, is the best, which corresponds with previous findings.</p>
</div>
<div id="logarithmic-model" class="section level4" number="2.3.1.2">
<h4><span class="header-section-number">2.3.1.2</span> Logarithmic model</h4>
<p>The procedure is per se the same, but now we are working with a probabilistic model instead of. Hence the outcome must be binary. Thus, it is decided to predict whether a persons wage is higher or lower than 250.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="lab-section.html#cb24-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">~</span> <span class="fu">poly</span>(age,<span class="dv">4</span>) <span class="co">#Note the use of I()</span></span>
<span id="cb24-2"><a href="lab-section.html#cb24-2" aria-hidden="true" tabindex="-1"></a>           ,<span class="at">data =</span> df</span>
<span id="cb24-3"><a href="lab-section.html#cb24-3" aria-hidden="true" tabindex="-1"></a>           ,<span class="at">family =</span> binomial)</span></code></pre></div>
<p>Note, that again <code>I()</code> is used, where the expression is evaluated on the fly, one could naturally also had made a vector of the classes.</p>
<p><em>Note, by default <code>glm()</code> will transform TRUE and FALSE to respectively 1 and 0.</em></p>
<p>Now we can make predictions, which are logits, these can be used for much, hence later we will transform them into probabilities.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="lab-section.html#cb25-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">=</span> <span class="fu">predict</span>(fit</span>
<span id="cb25-2"><a href="lab-section.html#cb25-2" aria-hidden="true" tabindex="-1"></a>                ,<span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age=</span>age.grid)</span>
<span id="cb25-3"><a href="lab-section.html#cb25-3" aria-hidden="true" tabindex="-1"></a>                ,<span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-4"><a href="lab-section.html#cb25-4" aria-hidden="true" tabindex="-1"></a>                <span class="co"># We could have added type = response to get probabilities</span></span>
<span id="cb25-5"><a href="lab-section.html#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="lab-section.html#cb25-6" aria-hidden="true" tabindex="-1"></a>preds<span class="sc">$</span>fit[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]<span class="co">#First 10 logits</span></span></code></pre></div>
<pre><code>##          1          2          3          4          5          6          7 
## -18.438190 -16.395452 -14.560646 -12.919746 -11.459196 -10.165904  -9.027249 
##          8          9         10 
##  -8.031077  -7.165700  -6.419899</code></pre>
<p>To make confidence intevals for Pr(Y = 1|X), i.e.</p>
<p><span class="math display" id="eq:LogConfidenceinterval">\[\begin{equation}
Pr(Y=1|X)= \frac{exp(X\beta)}{1+exp(X\beta)}
\tag{2.5}
\end{equation}\]</span></p>
<p>Where <span class="math inline">\(X\beta\)</span> can be explained by:</p>
<p><span class="math display" id="eq:XBeta">\[\begin{equation}
log(\frac{Pr(Y=1|X)}{1-Pr(Y=1|X)})=X\beta
\tag{2.6}
\end{equation}\]</span></p>
<p>Hence we must first calculate <span class="math inline">\(X\beta\)</span> to find Pr(Y=1|X).</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="lab-section.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Making Prbabilities</span></span>
<span id="cb27-2"><a href="lab-section.html#cb27-2" aria-hidden="true" tabindex="-1"></a>pfit <span class="ot">=</span> <span class="fu">exp</span>(preds<span class="sc">$</span>fit)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(preds<span class="sc">$</span>fit)) <span class="co">#See equation above</span></span>
<span id="cb27-3"><a href="lab-section.html#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="lab-section.html#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">#X beta</span></span>
<span id="cb27-5"><a href="lab-section.html#cb27-5" aria-hidden="true" tabindex="-1"></a>se.bands.logit <span class="ot">=</span> <span class="fu">cbind</span>(preds<span class="sc">$</span>fit<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>preds<span class="sc">$</span>se.fit <span class="co">#Upper level</span></span>
<span id="cb27-6"><a href="lab-section.html#cb27-6" aria-hidden="true" tabindex="-1"></a>                       ,preds<span class="sc">$</span>fit<span class="dv">-2</span><span class="sc">*</span>preds<span class="sc">$</span>se.fit) <span class="co">#Lower level</span></span>
<span id="cb27-7"><a href="lab-section.html#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="lab-section.html#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Pr(Y = 1|X)</span></span>
<span id="cb27-9"><a href="lab-section.html#cb27-9" aria-hidden="true" tabindex="-1"></a>se.bands <span class="ot">=</span> <span class="fu">exp</span>(se.bands.logit)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(se.bands.logit))</span></code></pre></div>
<p>Remember that 2 SE = 95%, thus with the confidence levels we expect to contain 95% of the data.</p>
<p>Notice, that the posterior probabilities could also have been found by using <code>predict()</code>, see the following:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="lab-section.html#cb28-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">=</span> <span class="fu">predict</span> (fit</span>
<span id="cb28-2"><a href="lab-section.html#cb28-2" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid)</span>
<span id="cb28-3"><a href="lab-section.html#cb28-3" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">type =</span> <span class="st">&quot;response&quot;</span> <span class="co">#Getting probabilities instead of logits</span></span>
<span id="cb28-4"><a href="lab-section.html#cb28-4" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><strong>NOTICE: for some reason this will lead to wrong confidence intervals <span class="citation">(<a href="references.html#ref-hastie2013" role="doc-biblioref">Hastie et al. 2013, 292</a>)</span>, thus we prefer the regular approach, as shown before</strong></p>
<p>Now we can make the right hand plot, so we can compare with continous result.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="lab-section.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb29-2"><a href="lab-section.html#cb29-2" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="fl">4.5</span>,<span class="fl">4.5</span>,<span class="fl">1.1</span>) <span class="co">#Controls the margins</span></span>
<span id="cb29-3"><a href="lab-section.html#cb29-3" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>)) <span class="co">#Controls the margins</span></span>
<span id="cb29-4"><a href="lab-section.html#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Copy from earlier to combine plots</span></span>
<span id="cb29-5"><a href="lab-section.html#cb29-5" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age,<span class="dv">4</span>) <span class="co">#Orthogonal polynomials</span></span>
<span id="cb29-6"><a href="lab-section.html#cb29-6" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">data =</span> df)</span>
<span id="cb29-7"><a href="lab-section.html#cb29-7" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> fit</span>
<span id="cb29-8"><a href="lab-section.html#cb29-8" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid)</span>
<span id="cb29-9"><a href="lab-section.html#cb29-9" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-10"><a href="lab-section.html#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> df<span class="sc">$</span>age,<span class="at">y =</span> df<span class="sc">$</span>wage</span>
<span id="cb29-11"><a href="lab-section.html#cb29-11" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlim =</span> agelims</span>
<span id="cb29-12"><a href="lab-section.html#cb29-12" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">cex =</span> <span class="fl">0.5</span> <span class="co">#Size of dots</span></span>
<span id="cb29-13"><a href="lab-section.html#cb29-13" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb29-14"><a href="lab-section.html#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Degree-4 Polynomial&quot;</span>,<span class="at">outer =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-15"><a href="lab-section.html#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid,<span class="at">y =</span> preds<span class="sc">$</span>fit</span>
<span id="cb29-16"><a href="lab-section.html#cb29-16" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb29-17"><a href="lab-section.html#cb29-17" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb29-18"><a href="lab-section.html#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="lab-section.html#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co">#The new plot</span></span>
<span id="cb29-20"><a href="lab-section.html#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> age,<span class="at">y =</span> <span class="fu">I</span>(wage <span class="sc">&gt;</span><span class="dv">250</span>)</span>
<span id="cb29-21"><a href="lab-section.html#cb29-21" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlim =</span> agelims</span>
<span id="cb29-22"><a href="lab-section.html#cb29-22" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">type =</span><span class="st">&quot;n&quot;</span></span>
<span id="cb29-23"><a href="lab-section.html#cb29-23" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">2</span>))</span>
<span id="cb29-24"><a href="lab-section.html#cb29-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-25"><a href="lab-section.html#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">jitter</span>(age)</span>
<span id="cb29-26"><a href="lab-section.html#cb29-26" aria-hidden="true" tabindex="-1"></a>       ,<span class="fu">I</span>((wage<span class="sc">&gt;</span><span class="dv">250</span>)<span class="sc">/</span><span class="dv">5</span>)</span>
<span id="cb29-27"><a href="lab-section.html#cb29-27" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">cex =</span> .<span class="dv">5</span></span>
<span id="cb29-28"><a href="lab-section.html#cb29-28" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">pch =</span> <span class="st">&quot;|&quot;</span></span>
<span id="cb29-29"><a href="lab-section.html#cb29-29" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb29-30"><a href="lab-section.html#cb29-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-31"><a href="lab-section.html#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid,<span class="at">y =</span> pfit</span>
<span id="cb29-32"><a href="lab-section.html#cb29-32" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb29-33"><a href="lab-section.html#cb29-33" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">col=</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb29-34"><a href="lab-section.html#cb29-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-35"><a href="lab-section.html#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="fu">matlines</span>(<span class="at">x =</span> age.grid</span>
<span id="cb29-36"><a href="lab-section.html#cb29-36" aria-hidden="true" tabindex="-1"></a>         ,<span class="at">y =</span> se.bands</span>
<span id="cb29-37"><a href="lab-section.html#cb29-37" aria-hidden="true" tabindex="-1"></a>         ,<span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb29-38"><a href="lab-section.html#cb29-38" aria-hidden="true" tabindex="-1"></a>         ,<span class="at">col =</span> <span class="st">&quot;blue&quot;</span></span>
<span id="cb29-39"><a href="lab-section.html#cb29-39" aria-hidden="true" tabindex="-1"></a>         ,<span class="at">lty =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-25-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see on the right hand panel that the all the observations that have a wage above 250 is in the top and all those below hare in the bottom of the visualization. Although at the tail, we aren’t able to conclude much, as confidence interval is really high, hence it can both be high and low earners.</p>
<p><code>jitter()</code> is merely an approach to avoid observations to overlap each other.</p>
</div>
<div id="step-function" class="section level4" number="2.3.1.3">
<h4><span class="header-section-number">2.3.1.3</span> Step function</h4>
<p>To fit the step function we must do:</p>
<ol style="list-style-type: decimal">
<li>Define the cuts, <code>cut()</code> is able to automatically pick cutpoints. One could also use <code>break()</code> to define where the cuts should be.</li>
<li>Train the model. Notice, that <code>lm()</code> will automatically create dummy variables for the ranges.</li>
</ol>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="lab-section.html#cb30-1" aria-hidden="true" tabindex="-1"></a>{<span class="fu">table</span>(<span class="fu">cut</span>(df<span class="sc">$</span>age,<span class="dv">4</span>)) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb30-2"><a href="lab-section.html#cb30-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">cut</span>(df<span class="sc">$</span>age,<span class="dv">4</span>)</span>
<span id="cb30-3"><a href="lab-section.html#cb30-3" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">data =</span> df)</span>
<span id="cb30-4"><a href="lab-section.html#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">summary</span>(fit)) <span class="sc">%&gt;%</span> <span class="fu">print</span>()}</span></code></pre></div>
<pre><code>## 
## (17.9,33.5]   (33.5,49]   (49,64.5] (64.5,80.1] 
##         750        1399         779          72 
##                            Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept)               94.158392   1.476069 63.789970 0.000000e+00
## cut(df$age, 4)(33.5,49]   24.053491   1.829431 13.148074 1.982315e-38
## cut(df$age, 4)(49,64.5]   23.664559   2.067958 11.443444 1.040750e-29
## cut(df$age, 4)(64.5,80.1]  7.640592   4.987424  1.531972 1.256350e-01</code></pre>
<p>We see that the p value of the cuts are significant, not that we can use the p-values for much.</p>
<p>Notice, that the first range is the base level, thus it is also left out. We can then use the intercept as the average wage for all in the range of up to 33.5 years.</p>
<p>Hence for a 40 year old person, the model will say that he has an wage of 94 + 24 = 118</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="lab-section.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code></pre></div>
</div>
</div>
<div id="splines" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Splines</h3>
<p>The different approaches to splines are presented in the following.</p>
<div id="basis-function-splines" class="section level4" number="2.3.2.1">
<h4><span class="header-section-number">2.3.2.1</span> Basis Function Splines</h4>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="lab-section.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR)</span>
<span id="cb33-2"><a href="lab-section.html#cb33-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> Wage</span>
<span id="cb33-3"><a href="lab-section.html#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb33-4"><a href="lab-section.html#cb33-4" aria-hidden="true" tabindex="-1"></a>agelims <span class="ot">&lt;-</span> <span class="fu">range</span>(df<span class="sc">$</span>age) <span class="co">#The min and max</span></span>
<span id="cb33-5"><a href="lab-section.html#cb33-5" aria-hidden="true" tabindex="-1"></a>age.grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> agelims[<span class="dv">1</span>],<span class="at">to =</span> agelims[<span class="dv">2</span>]) <span class="co">#Creating a counter within the range</span></span></code></pre></div>
<p>The splines library contain what we need. We introduce the following functions:</p>
<ul>
<li><code>bs()</code>: Basis functions for splines. Generates entire matrix of basis functions for splines with the specified set of knots.</li>
<li><code>ns()</code>: Natural splines.</li>
<li><code>smooth.spline()</code>: Used when fitting smoothing splines.</li>
<li><code>loess()</code>: When fitting local regression.</li>
</ul>
<p>Note, that by default the splines will be choosen to be 3, this can also be found in the function documentation.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="lab-section.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb34-2"><a href="lab-section.html#cb34-2" aria-hidden="true" tabindex="-1"></a>fit.bs <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">bs</span>(age,<span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">40</span>,<span class="dv">60</span>)) <span class="co">#we just chose the knots randomly</span></span>
<span id="cb34-3"><a href="lab-section.html#cb34-3" aria-hidden="true" tabindex="-1"></a>             ,<span class="at">data =</span> df)</span>
<span id="cb34-4"><a href="lab-section.html#cb34-4" aria-hidden="true" tabindex="-1"></a>pred.bs <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.bs</span>
<span id="cb34-5"><a href="lab-section.html#cb34-5" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid)</span>
<span id="cb34-6"><a href="lab-section.html#cb34-6" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-7"><a href="lab-section.html#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df<span class="sc">$</span>age</span>
<span id="cb34-8"><a href="lab-section.html#cb34-8" aria-hidden="true" tabindex="-1"></a>     ,df<span class="sc">$</span>wage</span>
<span id="cb34-9"><a href="lab-section.html#cb34-9" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span> <span class="st">&quot;gray&quot;</span>)</span>
<span id="cb34-10"><a href="lab-section.html#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="lab-section.html#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid</span>
<span id="cb34-12"><a href="lab-section.html#cb34-12" aria-hidden="true" tabindex="-1"></a>      ,pred.bs<span class="sc">$</span>fit</span>
<span id="cb34-13"><a href="lab-section.html#cb34-13" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb34-14"><a href="lab-section.html#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="lab-section.html#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid</span>
<span id="cb34-16"><a href="lab-section.html#cb34-16" aria-hidden="true" tabindex="-1"></a>      ,pred.bs<span class="sc">$</span>fit<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>pred.bs<span class="sc">$</span>se</span>
<span id="cb34-17"><a href="lab-section.html#cb34-17" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb34-18"><a href="lab-section.html#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="lab-section.html#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid</span>
<span id="cb34-20"><a href="lab-section.html#cb34-20" aria-hidden="true" tabindex="-1"></a>      ,pred.bs<span class="sc">$</span>fit<span class="dv">-2</span><span class="sc">*</span>pred.bs<span class="sc">$</span>se</span>
<span id="cb34-21"><a href="lab-section.html#cb34-21" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb34-22"><a href="lab-section.html#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="lab-section.html#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Splines - Basis Functions&quot;</span>)</span></code></pre></div>
<p><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-29-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that the splines have been fitted to the data and notice that the tails have wider confidence intervals.</p>
<p>We can get the amount of degrees of freedom by calling the <code>dim()</code>function.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="lab-section.html#cb35-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb35-2"><a href="lab-section.html#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Specifying the knots</span></span>
<span id="cb35-3"><a href="lab-section.html#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(<span class="fu">bs</span>(age,<span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">40</span>,<span class="dv">60</span>))) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb35-4"><a href="lab-section.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-5"><a href="lab-section.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#df can be specified instead of knots</span></span>
<span id="cb35-6"><a href="lab-section.html#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(<span class="fu">bs</span>(age,<span class="at">df =</span> <span class="dv">6</span>)) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb35-7"><a href="lab-section.html#cb35-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 3000    6
## [1] 3000    6</code></pre>
<p>We see that the two alternatives produce the same results.</p>
<p>Notice, that there are packages that will optimize the amount of knots.</p>
<p>We can assess where the <code>bs()</code> placed the knots, by calling the <code>attr()</code>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="lab-section.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">bs</span>(age,<span class="at">df=</span><span class="dv">6</span>),<span class="st">&quot;knots&quot;</span>)</span></code></pre></div>
<pre><code>##   25%   50%   75% 
## 33.75 42.00 51.00</code></pre>
<p>In this case, R chose the 25%, 50% and 75% quantiles.</p>
</div>
<div id="natural-splines" class="section level4" number="2.3.2.2">
<h4><span class="header-section-number">2.3.2.2</span> Natural Splines</h4>
<p>It similar to bs(), but it has an additional condition. I did not really get it.</p>
<p>The fitting procedure is the same, but now we just use <code>ns()</code> instead of <code>bs()</code>.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="lab-section.html#cb39-1" aria-hidden="true" tabindex="-1"></a>fit.ns <span class="ot">=</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">ns</span>(age</span>
<span id="cb39-2"><a href="lab-section.html#cb39-2" aria-hidden="true" tabindex="-1"></a>                      ,<span class="at">df =</span> <span class="dv">4</span> <span class="co">#Note, as with bs() we could have specified the knots instead of.</span></span>
<span id="cb39-3"><a href="lab-section.html#cb39-3" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb39-4"><a href="lab-section.html#cb39-4" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">data =</span> df)</span>
<span id="cb39-5"><a href="lab-section.html#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="lab-section.html#cb39-6" aria-hidden="true" tabindex="-1"></a>pred.ns <span class="ot">=</span> <span class="fu">predict</span>(fit.ns</span>
<span id="cb39-7"><a href="lab-section.html#cb39-7" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age=</span>age.grid)</span>
<span id="cb39-8"><a href="lab-section.html#cb39-8" aria-hidden="true" tabindex="-1"></a>                  ,<span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-9"><a href="lab-section.html#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="lab-section.html#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Copy of old plot</span></span>
<span id="cb39-11"><a href="lab-section.html#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(df<span class="sc">$</span>age</span>
<span id="cb39-12"><a href="lab-section.html#cb39-12" aria-hidden="true" tabindex="-1"></a>       ,df<span class="sc">$</span>wage</span>
<span id="cb39-13"><a href="lab-section.html#cb39-13" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">col =</span> <span class="st">&quot;gray&quot;</span>)</span>
<span id="cb39-14"><a href="lab-section.html#cb39-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-15"><a href="lab-section.html#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(age.grid</span>
<span id="cb39-16"><a href="lab-section.html#cb39-16" aria-hidden="true" tabindex="-1"></a>        ,pred.bs<span class="sc">$</span>fit</span>
<span id="cb39-17"><a href="lab-section.html#cb39-17" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-18"><a href="lab-section.html#cb39-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-19"><a href="lab-section.html#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(age.grid</span>
<span id="cb39-20"><a href="lab-section.html#cb39-20" aria-hidden="true" tabindex="-1"></a>        ,pred.bs<span class="sc">$</span>fit<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>pred.bs<span class="sc">$</span>se</span>
<span id="cb39-21"><a href="lab-section.html#cb39-21" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb39-22"><a href="lab-section.html#cb39-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-23"><a href="lab-section.html#cb39-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(age.grid</span>
<span id="cb39-24"><a href="lab-section.html#cb39-24" aria-hidden="true" tabindex="-1"></a>        ,pred.bs<span class="sc">$</span>fit<span class="dv">-2</span><span class="sc">*</span>pred.bs<span class="sc">$</span>se</span>
<span id="cb39-25"><a href="lab-section.html#cb39-25" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb39-26"><a href="lab-section.html#cb39-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-27"><a href="lab-section.html#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding natural splines</span></span>
<span id="cb39-28"><a href="lab-section.html#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid</span>
<span id="cb39-29"><a href="lab-section.html#cb39-29" aria-hidden="true" tabindex="-1"></a>      ,pred.ns<span class="sc">$</span>fit</span>
<span id="cb39-30"><a href="lab-section.html#cb39-30" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">col =</span><span class="st">&quot;red&quot;</span></span>
<span id="cb39-31"><a href="lab-section.html#cb39-31" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lwd =</span><span class="dv">2</span>)</span>
<span id="cb39-32"><a href="lab-section.html#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="lab-section.html#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Splines - Basis Functions + Natural Splines&quot;</span>)</span>
<span id="cb39-34"><a href="lab-section.html#cb39-34" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,<span class="fu">c</span>(<span class="st">&quot;Basis&quot;</span>,<span class="st">&quot;Natural&quot;</span>),<span class="at">lty =</span> <span class="dv">1</span>,<span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;Black&quot;</span>,<span class="st">&quot;Red&quot;</span>),<span class="at">cex =</span> <span class="fl">0.6</span>)</span></code></pre></div>
<p><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-32-1.png" width="720" style="display: block; margin: auto;" /></p>
</div>
<div id="smooth-splines" class="section level4" number="2.3.2.3">
<h4><span class="header-section-number">2.3.2.3</span> Smooth Splines</h4>
<p>As we discovered in the first part of the chapter, it sets a knot at each observation, and then we will penalize the function with a lamda (<span class="math inline">\(\lambda\)</span>), to avoid overfitting.</p>
<p>The code show the procedure.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="lab-section.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Hardcoding degrees of freedom</span></span>
<span id="cb40-2"><a href="lab-section.html#cb40-2" aria-hidden="true" tabindex="-1"></a>fit.ss <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(<span class="at">x =</span> df<span class="sc">$</span>age,<span class="at">y =</span> df<span class="sc">$</span>wage</span>
<span id="cb40-3"><a href="lab-section.html#cb40-3" aria-hidden="true" tabindex="-1"></a>                     ,<span class="at">df =</span> <span class="dv">16</span>) <span class="co">#Remember that we must impose constraints</span></span>
<span id="cb40-4"><a href="lab-section.html#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="lab-section.html#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Choosing smoothing param with CV</span></span>
<span id="cb40-6"><a href="lab-section.html#cb40-6" aria-hidden="true" tabindex="-1"></a>fit.ss2 <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span> (df<span class="sc">$</span>age</span>
<span id="cb40-7"><a href="lab-section.html#cb40-7" aria-hidden="true" tabindex="-1"></a>                          ,df<span class="sc">$</span>wage</span>
<span id="cb40-8"><a href="lab-section.html#cb40-8" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">cv =</span> <span class="cn">TRUE</span>) <span class="co">#we choose cv instead of fixed amount of df</span></span>
<span id="cb40-9"><a href="lab-section.html#cb40-9" aria-hidden="true" tabindex="-1"></a>fit.ss2<span class="sc">$</span>df</span></code></pre></div>
<pre><code>## [1] 6.794596</code></pre>
<p>We get sparsity hence we have degrees of freedom of 6.8. That is due to the tuning parameter which was found by the cross validation proces. We can find the specific lambda value with the following:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="lab-section.html#cb42-1" aria-hidden="true" tabindex="-1"></a>fit.ss2<span class="sc">$</span>lambda</span></code></pre></div>
<pre><code>## [1] 0.02792303</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="lab-section.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(age,wage</span>
<span id="cb44-2"><a href="lab-section.html#cb44-2" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlim =</span> agelims</span>
<span id="cb44-3"><a href="lab-section.html#cb44-3" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">cex =</span> .<span class="dv">5</span></span>
<span id="cb44-4"><a href="lab-section.html#cb44-4" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb44-5"><a href="lab-section.html#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Smoothing Spline&quot;</span>)</span>
<span id="cb44-6"><a href="lab-section.html#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="lab-section.html#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.ss,<span class="at">col =</span> <span class="st">&quot;red&quot;</span>,<span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb44-8"><a href="lab-section.html#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.ss2,<span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,<span class="at">lwd =</span><span class="dv">2</span>)</span>
<span id="cb44-9"><a href="lab-section.html#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="lab-section.html#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,<span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;16 DF&quot;</span>,<span class="st">&quot;6.8 DF&quot;</span>)</span>
<span id="cb44-11"><a href="lab-section.html#cb44-11" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>)</span>
<span id="cb44-12"><a href="lab-section.html#cb44-12" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">lty =</span> <span class="dv">1</span></span>
<span id="cb44-13"><a href="lab-section.html#cb44-13" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb44-14"><a href="lab-section.html#cb44-14" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">cex =</span> .<span class="dv">8</span>)</span></code></pre></div>
<p><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-35-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>As expected, we see that the more complex model (highest amount of df) is the more flexible model.</p>
<p>Note: tuning parameter = <span class="math inline">\(\lambda\)</span>, where the CV seeks to choose the parameter that leads to the lowest error and return the df that leads to this level.</p>
</div>
<div id="local-regression-1" class="section level4" number="2.3.2.4">
<h4><span class="header-section-number">2.3.2.4</span> Local Regression</h4>
<p>Recall that local regression makes a linear regression for the observations that are close to the observation under evaluation (<span class="math inline">\(x_0\)</span>).</p>
<p>Thus we have to specify the span, the larger the span the smoother the fit, as we will include more observations.</p>
<p>NB: <code>locfit</code> library can also be used for fitting local regress</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="lab-section.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> df<span class="sc">$</span>age,<span class="at">y =</span> df<span class="sc">$</span>wage</span>
<span id="cb45-2"><a href="lab-section.html#cb45-2" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlim =</span> agelims</span>
<span id="cb45-3"><a href="lab-section.html#cb45-3" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">cex =</span> .<span class="dv">5</span></span>
<span id="cb45-4"><a href="lab-section.html#cb45-4" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb45-5"><a href="lab-section.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span> (<span class="st">&quot;Local Regression&quot;</span>)</span>
<span id="cb45-6"><a href="lab-section.html#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="lab-section.html#cb45-7" aria-hidden="true" tabindex="-1"></a>fit.lr <span class="ot">&lt;-</span> <span class="fu">loess</span>(wage <span class="sc">~</span> age</span>
<span id="cb45-8"><a href="lab-section.html#cb45-8" aria-hidden="true" tabindex="-1"></a>                ,<span class="at">span =</span> .<span class="dv">2</span> <span class="co">#Degree of smoothing / neighborhood to be included</span></span>
<span id="cb45-9"><a href="lab-section.html#cb45-9" aria-hidden="true" tabindex="-1"></a>                ,<span class="at">data =</span> df)</span>
<span id="cb45-10"><a href="lab-section.html#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="lab-section.html#cb45-11" aria-hidden="true" tabindex="-1"></a>fit.lr2 <span class="ot">&lt;-</span> <span class="fu">loess</span>(wage <span class="sc">~</span> age</span>
<span id="cb45-12"><a href="lab-section.html#cb45-12" aria-hidden="true" tabindex="-1"></a>              ,<span class="at">span =</span> .<span class="dv">5</span> <span class="co">#Degree of smoothing / neighborhood to be included</span></span>
<span id="cb45-13"><a href="lab-section.html#cb45-13" aria-hidden="true" tabindex="-1"></a>              ,<span class="at">data =</span> df)</span>
<span id="cb45-14"><a href="lab-section.html#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="lab-section.html#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid,<span class="at">y =</span> <span class="fu">predict</span>(<span class="at">object =</span> fit.lr,<span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age=</span>age.grid))</span>
<span id="cb45-16"><a href="lab-section.html#cb45-16" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">col =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb45-17"><a href="lab-section.html#cb45-17" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb45-18"><a href="lab-section.html#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="lab-section.html#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> age.grid,<span class="at">y =</span> <span class="fu">predict</span>(<span class="at">object =</span> fit.lr2,<span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">age=</span>age.grid))</span>
<span id="cb45-20"><a href="lab-section.html#cb45-20" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">col =</span><span class="st">&quot; blue&quot;</span></span>
<span id="cb45-21"><a href="lab-section.html#cb45-21" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb45-22"><a href="lab-section.html#cb45-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-23"><a href="lab-section.html#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="st">&quot;topright&quot;</span></span>
<span id="cb45-24"><a href="lab-section.html#cb45-24" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Span = 0.2&quot;</span>,<span class="st">&quot;Span = 0.5&quot;</span>)</span>
<span id="cb45-25"><a href="lab-section.html#cb45-25" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>)</span>
<span id="cb45-26"><a href="lab-section.html#cb45-26" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">lty =</span> <span class="dv">1</span></span>
<span id="cb45-27"><a href="lab-section.html#cb45-27" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb45-28"><a href="lab-section.html#cb45-28" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">cex =</span> .<span class="dv">8</span>)</span></code></pre></div>
<p><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-36-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>From the plot we also see that the model with the largest span has the smoothest fit.</p>
</div>
</div>
<div id="gams" class="section level3" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> GAMs</h3>
<p>We want to predict wage, where year, age and education (as categorical) as predictors.</p>
<div id="with-only-natural-splines" class="section level4" number="2.3.3.1">
<h4><span class="header-section-number">2.3.3.1</span> With only natural splines</h4>
<p>According to the <span class="citation"><a href="references.html#ref-hastie2013" role="doc-biblioref">Hastie et al.</a> (<a href="references.html#ref-hastie2013" role="doc-biblioref">2013</a>)</span>, 294, this is just a bunch of linear functions, hence we can merely apply <code>lm()</code>, see the following.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="lab-section.html#cb46-1" aria-hidden="true" tabindex="-1"></a>gam.m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">ns</span>(year,<span class="at">df =</span> <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">ns</span>(age,<span class="at">df =</span> <span class="dv">5</span>) <span class="sc">+</span> education <span class="co">#NOTICE, that we just use lm()</span></span>
<span id="cb46-2"><a href="lab-section.html#cb46-2" aria-hidden="true" tabindex="-1"></a>             ,<span class="at">data =</span> df)</span>
<span id="cb46-3"><a href="lab-section.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gam.m1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wage ~ ns(year, df = 4) + ns(age, df = 5) + education, 
##     data = df)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -120.513  -19.608   -3.583   14.112  214.535 
## 
## Coefficients:
##                             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                   46.949      4.704   9.980  &lt; 2e-16 ***
## ns(year, df = 4)1              8.625      3.466   2.488  0.01289 *  
## ns(year, df = 4)2              3.762      2.959   1.271  0.20369    
## ns(year, df = 4)3              8.127      4.211   1.930  0.05375 .  
## ns(year, df = 4)4              6.806      2.397   2.840  0.00455 ** 
## ns(age, df = 5)1              45.170      4.193  10.771  &lt; 2e-16 ***
## ns(age, df = 5)2              38.450      5.076   7.575 4.78e-14 ***
## ns(age, df = 5)3              34.239      4.383   7.813 7.69e-15 ***
## ns(age, df = 5)4              48.678     10.572   4.605 4.31e-06 ***
## ns(age, df = 5)5               6.557      8.367   0.784  0.43328    
## education2. HS Grad           10.983      2.430   4.520 6.43e-06 ***
## education3. Some College      23.473      2.562   9.163  &lt; 2e-16 ***
## education4. College Grad      38.314      2.547  15.042  &lt; 2e-16 ***
## education5. Advanced Degree   62.554      2.761  22.654  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 35.16 on 2986 degrees of freedom
## Multiple R-squared:  0.293,  Adjusted R-squared:  0.2899 
## F-statistic:  95.2 on 13 and 2986 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>From the summary we see the variables that have been created and also the factor levels for education.</p>
<p>Again, we don’t have to interprete the coefficients, we just need to look at the shape.</p>
</div>
<div id="with-different-splines" class="section level4" number="2.3.3.2">
<h4><span class="header-section-number">2.3.3.2</span> With different splines</h4>
<p>Now we have to apply the package <code>gam</code>.</p>
<p><strong>This is the best approach.</strong></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="lab-section.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gam)</span></code></pre></div>
<p>We can also construct a GAM model, that contains smoothing splines, that is done by calling <code>s()</code>. Where year and age will be included with up to 4 and 5 degrees of freedom.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="lab-section.html#cb49-1" aria-hidden="true" tabindex="-1"></a>gam.m3 <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">s</span>(year,<span class="at">df =</span> <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">s</span>(age,<span class="at">df =</span> <span class="dv">5</span>) <span class="sc">+</span> education</span>
<span id="cb49-2"><a href="lab-section.html#cb49-2" aria-hidden="true" tabindex="-1"></a>              ,<span class="at">data =</span> df)</span></code></pre></div>
<p>Remember, that GAM fits each variable while holding all other variables fixed. The actual fitting procedure is called backfitting, and fits variables by repeatedly updating the fit for each predictor <span class="citation">(<a href="references.html#ref-hastie2013" role="doc-biblioref">Hastie et al. 2013, 284–85</a>)</span>. Hence, we create plots to interprete how.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="lab-section.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb50-2"><a href="lab-section.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gam.m3 <span class="co">#Note, automatically identifies the GAM object, hence plots for each variable</span></span>
<span id="cb50-3"><a href="lab-section.html#cb50-3" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">se =</span> <span class="cn">TRUE</span></span>
<span id="cb50-4"><a href="lab-section.html#cb50-4" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="Machine-Learning-Notes_files/figure-html/GAMPlotLab7.8.3-1.png" alt="GAM plot and intepretation" width="720" />
<p class="caption">
(#fig:GAMPlotLab7.8.3)GAM plot and intepretation
</p>
</div>
<p>Interpreting the plot: Recall that the plots assumes that we hold the other variables fixed, hence we see the following:</p>
<ul>
<li>Left: We see that holding education and age fixed, the wage tends to increase over the years, that is quite natural, e.g., because of inflation.</li>
<li>Center: Holding year and education fixed, we see that the wage tends to be highest in the middle region around 40-45 years of age. That is also quite intuitive that the wage first increase and then decreasing as the person gets closer to the retirement age.</li>
<li>Right: Holding year and age fixed, we see that the higher education you have, the higher will your wage be.</li>
</ul>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="lab-section.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb51-2"><a href="lab-section.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.Gam</span>(gam.m1</span>
<span id="cb51-3"><a href="lab-section.html#cb51-3" aria-hidden="true" tabindex="-1"></a>         ,<span class="at">se =</span> <span class="cn">TRUE</span></span>
<span id="cb51-4"><a href="lab-section.html#cb51-4" aria-hidden="true" tabindex="-1"></a>         ,<span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-40"></span>
<img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-40-1.png" alt="GAM of natural splines" width="720" />
<p class="caption">
Figure 2.3: GAM of natural splines
</p>
</div>
<p>Notice, that this plot looks very similar to @(fig:GAMPlotLab7.8.3).</p>
<p>This command could naturally also be used for the other GAM object, it is just that <code>plot()</code> does not automatically identify, that it is in fact intended to be interpretet as a GAM.</p>
</div>
<div id="but-what-variables-to-include" class="section level4" number="2.3.3.3">
<h4><span class="header-section-number">2.3.3.3</span> But what variables to include?</h4>
<p>It looks as is year is rather linear. To make this assessment, we can apply an ANOVA test of the different combinations. Hence:</p>
<p><em>Note, the first model is nested in the second model (has the same variables), hence we can use ANOVA</em></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="lab-section.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Excluding year</span></span>
<span id="cb52-2"><a href="lab-section.html#cb52-2" aria-hidden="true" tabindex="-1"></a>gam.m1 <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">s</span>(age,<span class="at">df =</span> <span class="dv">5</span>) <span class="sc">+</span> education</span>
<span id="cb52-3"><a href="lab-section.html#cb52-3" aria-hidden="true" tabindex="-1"></a>             ,<span class="at">data =</span> df)</span>
<span id="cb52-4"><a href="lab-section.html#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="lab-section.html#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Including year, but as a linear</span></span>
<span id="cb52-6"><a href="lab-section.html#cb52-6" aria-hidden="true" tabindex="-1"></a>gam.m2 <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> year <span class="sc">+</span> <span class="fu">s</span>(age,<span class="at">df =</span> <span class="dv">5</span>) <span class="sc">+</span> education</span>
<span id="cb52-7"><a href="lab-section.html#cb52-7" aria-hidden="true" tabindex="-1"></a>             ,<span class="at">data =</span> df)</span>
<span id="cb52-8"><a href="lab-section.html#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="lab-section.html#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(gam.m1,gam.m2,gam.m3,<span class="at">test =</span> <span class="st">&quot;F&quot;</span>)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">Resid. Df</th>
<th align="right">Resid. Dev</th>
<th align="right">Df</th>
<th align="right">Deviance</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2990</td>
<td align="right">3711731</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">2989</td>
<td align="right">3693842</td>
<td align="right">1.000000</td>
<td align="right">17889.243</td>
<td align="right">14.477130</td>
<td align="right">0.0001447</td>
</tr>
<tr class="odd">
<td align="right">2986</td>
<td align="right">3689770</td>
<td align="right">2.999989</td>
<td align="right">4071.134</td>
<td align="right">1.098212</td>
<td align="right">0.3485661</td>
</tr>
</tbody>
</table>
</div>
<p>We see that performance is significantly better going from model 1 to model 2, but on a five percent level, we are able to say, that we don’t gain anything with the third model, which is most complex model.</p>
<p>Thus, the linear constellation of year, with polynomials on age + education as factors, appear to be the best performing model.</p>
<p>With this in mind, it is interesting to assess the summary of the complex model:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="lab-section.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gam.m3)</span></code></pre></div>
<pre><code>## 
## Call: gam(formula = wage ~ s(year, df = 4) + s(age, df = 5) + education, 
##     data = df)
## Deviance Residuals:
##     Min      1Q  Median      3Q     Max 
## -119.43  -19.70   -3.33   14.17  213.48 
## 
## (Dispersion Parameter for gaussian family taken to be 1235.69)
## 
##     Null Deviance: 5222086 on 2999 degrees of freedom
## Residual Deviance: 3689770 on 2986 degrees of freedom
## AIC: 29887.75 
## 
## Number of Local Scoring Iterations: NA 
## 
## Anova for Parametric Effects
##                   Df  Sum Sq Mean Sq F value      Pr(&gt;F)    
## s(year, df = 4)    1   27162   27162  21.981 0.000002877 ***
## s(age, df = 5)     1  195338  195338 158.081   &lt; 2.2e-16 ***
## education          4 1069726  267432 216.423   &lt; 2.2e-16 ***
## Residuals       2986 3689770    1236                        
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Anova for Nonparametric Effects
##                 Npar Df Npar F  Pr(F)    
## (Intercept)                              
## s(year, df = 4)       3  1.086 0.3537    
## s(age, df = 5)        4 32.380 &lt;2e-16 ***
## education                                
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Looking at the section: “Anova for Nonparametric Effects,” we see that the smoothing spline on year, is not significant, hence it supports the conclusion from above, that we are better off, including the year as a linear variable.</p>
<p>Now we can make predictions.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="lab-section.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Predictions with linear year, non linear age and factors of education</span></span>
<span id="cb55-2"><a href="lab-section.html#cb55-2" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span><span class="fu">predict</span>(gam.m2</span>
<span id="cb55-3"><a href="lab-section.html#cb55-3" aria-hidden="true" tabindex="-1"></a>                ,<span class="at">newdata =</span> df)</span></code></pre></div>
</div>
<div id="gam-with-local-regression" class="section level4" number="2.3.3.4">
<h4><span class="header-section-number">2.3.3.4</span> GAM with local regression</h4>
<p>We are also able to make GAM on other building blocks, for instance local regression, that will be shown in the following</p>
<p>For some reason the following cant be run.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="lab-section.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#GAM with local regression</span></span>
<span id="cb56-2"><a href="lab-section.html#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="lab-section.html#cb56-3" aria-hidden="true" tabindex="-1"></a>gam.lo <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">s</span>(df<span class="sc">$</span>year,<span class="at">df =</span> <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">lo</span>(df<span class="sc">$</span>age,<span class="at">span =</span> <span class="fl">0.7</span>) <span class="sc">+</span> education</span>
<span id="cb56-4"><a href="lab-section.html#cb56-4" aria-hidden="true" tabindex="-1"></a>               ,<span class="at">data =</span> df)</span>
<span id="cb56-5"><a href="lab-section.html#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="lab-section.html#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot.Gam(gam.lo #For some reason it cant be plotted</span></span>
<span id="cb56-7"><a href="lab-section.html#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co">#          ,se = TRUE</span></span>
<span id="cb56-8"><a href="lab-section.html#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co">#          ,col = &quot;green&quot;)</span></span></code></pre></div>
<p>Making interactions in the local regression:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="lab-section.html#cb57-1" aria-hidden="true" tabindex="-1"></a>gam.lo.i <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">lo</span>(year,age,<span class="at">span =</span> <span class="fl">0.5</span>) <span class="sc">+</span> education</span>
<span id="cb57-2"><a href="lab-section.html#cb57-2" aria-hidden="true" tabindex="-1"></a>                ,<span class="at">data =</span> df)</span>
<span id="cb57-3"><a href="lab-section.html#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="lab-section.html#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(akima) </span>
<span id="cb57-5"><a href="lab-section.html#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gam.lo.i)</span></code></pre></div>
<p><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-45-1.png" width="720" style="display: block; margin: auto;" /><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-45-2.png" width="720" style="display: block; margin: auto;" /></p>
</div>
<div id="logistic-regression" class="section level4" number="2.3.3.5">
<h4><span class="header-section-number">2.3.3.5</span> Logistic Regression</h4>
<p>Plotting logistic regression GAM, here we can apply <code>I()</code> as previous used, to make the expression on the fly.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="lab-section.html#cb58-1" aria-hidden="true" tabindex="-1"></a>gam.lr <span class="ot">&lt;-</span> <span class="fu">gam</span>(<span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">~</span> year <span class="sc">+</span> <span class="fu">s</span>(age,<span class="at">df =</span> <span class="dv">5</span>) <span class="sc">+</span> education</span>
<span id="cb58-2"><a href="lab-section.html#cb58-2" aria-hidden="true" tabindex="-1"></a>              ,<span class="at">family =</span> binomial</span>
<span id="cb58-3"><a href="lab-section.html#cb58-3" aria-hidden="true" tabindex="-1"></a>              ,<span class="at">data =</span> df)</span>
<span id="cb58-4"><a href="lab-section.html#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="lab-section.html#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb58-6"><a href="lab-section.html#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gam.lr,<span class="at">se=</span>T,<span class="at">col =</span><span class="st">&quot; green &quot;</span>)</span></code></pre></div>
<p><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-46-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>One could interprete the plot and assess each window to see how the variable influence the decision wether the observation is above or below. Remember that the outcome can be seen as probabilities, these can also be plotted to be shown the spread:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="lab-section.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb59-2"><a href="lab-section.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gam.lr<span class="sc">$</span>fitted.values)</span></code></pre></div>
<p><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-47-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>From th plot, we see that there is a tendency that the lower the education the lower the wage, the following table show how the high earners are distributed.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="lab-section.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(education,<span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>))</span></code></pre></div>
<pre><code>##                     
## education            FALSE TRUE
##   1. &lt; HS Grad         268    0
##   2. HS Grad           966    5
##   3. Some College      643    7
##   4. College Grad      663   22
##   5. Advanced Degree   381   45</code></pre>
<p>We see that there are no people with less than high school degree that earns more than 250.</p>
<p>To get more sensible result, we can remove the observations with a low degree, this will also show a more sensible result for the other degrees, see the following.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="lab-section.html#cb62-1" aria-hidden="true" tabindex="-1"></a>gam.lr.s <span class="ot">=</span> <span class="fu">gam</span>(<span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">~</span> year <span class="sc">+</span> <span class="fu">s</span>(age,<span class="at">df =</span> <span class="dv">5</span>) <span class="sc">+</span> education</span>
<span id="cb62-2"><a href="lab-section.html#cb62-2" aria-hidden="true" tabindex="-1"></a>               ,<span class="at">family =</span> binomial</span>
<span id="cb62-3"><a href="lab-section.html#cb62-3" aria-hidden="true" tabindex="-1"></a>               ,<span class="at">data =</span> df</span>
<span id="cb62-4"><a href="lab-section.html#cb62-4" aria-hidden="true" tabindex="-1"></a>               ,<span class="at">subset =</span> (education <span class="sc">!=</span> <span class="st">&quot;1. &lt; HS Grad&quot;</span>)) <span class="co">#removing people in the lowest group of education.</span></span>
<span id="cb62-5"><a href="lab-section.html#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb62-6"><a href="lab-section.html#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gam.lr.s</span>
<span id="cb62-7"><a href="lab-section.html#cb62-7" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">se =</span> <span class="cn">TRUE</span> <span class="co">#Standard errors</span></span>
<span id="cb62-8"><a href="lab-section.html#cb62-8" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span><span class="st">&quot; green &quot;</span>)</span></code></pre></div>
<p><img src="Machine-Learning-Notes_files/figure-html/unnamed-chunk-49-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Do we need a nonlinear term for year?
Use anova for comparing the previous model with a model that includes a smooth spline of year with df=4</p>
<p>We can do an ANOVA, but please notice, we use Chi Square now.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="lab-section.html#cb63-1" aria-hidden="true" tabindex="-1"></a>gam.y.s <span class="ot">=</span> <span class="fu">gam</span>(<span class="fu">I</span>(wage<span class="sc">&gt;</span><span class="dv">250</span>) <span class="sc">~</span> <span class="fu">s</span>(year, <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">s</span>(age,<span class="dv">5</span>) <span class="sc">+</span> education,<span class="at">family=</span>binomial,<span class="at">data =</span> df,<span class="at">subset=</span>(education<span class="sc">!=</span><span class="st">&quot;1. &lt; HS Grad&quot;</span>)) </span>
<span id="cb63-2"><a href="lab-section.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(gam.lr.s,gam.y.s, <span class="at">test=</span><span class="st">&quot;Chisq&quot;</span>) <span class="co">#  Chi-square test as Dep variable is categorical</span></span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">Resid. Df</th>
<th align="right">Resid. Dev</th>
<th align="right">Df</th>
<th align="right">Deviance</th>
<th align="right">Pr(&gt;Chi)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2722</td>
<td align="right">602.4588</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">2719</td>
<td align="right">601.5718</td>
<td align="right">2.999982</td>
<td align="right">0.8869514</td>
<td align="right">0.8285731</td>
</tr>
</tbody>
</table>
</div>
<p>We do not need a non-linear term for year.</p>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="lecture-notes.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercises.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
